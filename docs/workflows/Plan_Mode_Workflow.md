# Plan Mode Workflow - Standard Operating Procedure

## Version History
- v1.0: Initial creation - Plan file location standards (2025-12-10)

---

## Purpose

This document defines the standard operating procedure for using Claude Code's Plan Mode, specifically regarding where to save implementation plans based on their purpose and lifecycle.

---

## Plan File Location Standards

### Rule: Location Based on Plan Type

**Branch-Specific Feature Plans** ‚Üí `docs/plans/v[X.Y]_[feature-name]_plan.md`
- Plans for versioned features that will be implemented in feature branches
- Tracked in git for project documentation
- Referenced in ROADMAP.md and CHANGELOG.md
- Preserved as implementation reference

**Ad Hoc/Exploratory Plans** ‚Üí `.claude/plans/[random-name].md`
- Temporary exploration or investigation plans
- Session-specific planning (gitignored)
- Not part of project documentation
- Automatically managed by Claude Code

---

## Decision Tree

```
Is this plan for a feature branch implementation?
‚îú‚îÄ YES ‚Üí docs/plans/v[X.Y]_[feature-name]_plan.md
‚îÇ         Examples:
‚îÇ         - docs/plans/v4.6_export_feature_plan.md
‚îÇ         - docs/plans/v4.5_action_verb_categorization_plan.md
‚îÇ         - docs/plans/v5.0_authentication_plan.md
‚îÇ
‚îî‚îÄ NO ‚Üí .claude/plans/[auto-generated-name].md
          Examples:
          - .claude/plans/stateless-coalescing-corbato.md (investigation)
          - .claude/plans/quick-exploration.md (research)
          - .claude/plans/bug-analysis.md (debugging)
```

---

## Workflow: Creating a Branch-Specific Plan

### Step 1: Enter Plan Mode
```
User: "Add export/download functionality for analysis reports"
Assistant: [Uses EnterPlanMode tool]
```

### Step 2: Plan Development
- Explore codebase
- Design implementation approach
- Document steps, considerations, risks
- Claude Code creates plan in `.claude/plans/[auto-name].md` by default

### Step 3: Move Plan to Proper Location
**Before exiting plan mode:**
```bash
# Copy plan to docs/plans with proper naming
cp .claude/plans/[auto-name].md docs/plans/v[X.Y]_[feature-name]_plan.md
```

**Naming Convention:**
- Format: `v[X.Y]_[feature-name]_plan.md`
- Use underscores for spaces
- Keep feature name concise but descriptive
- Include version number that matches the branch

**Examples:**
- `v4.6_export_feature_plan.md`
- `v5.0_multi_user_support_plan.md`
- `v4.7_resume_templates_plan.md`

### Step 4: Exit Plan Mode
- Call ExitPlanMode
- Plan is now tracked in git at proper location

### Step 5: Reference Plan in Implementation
- Create feature branch: `git checkout -b v4.6-export-feature`
- Reference plan in commit messages: `Ref: docs/plans/v4.6_export_feature_plan.md`
- Update ROADMAP.md to link to plan
- Mark plan as complete when feature is done

---

## Workflow: Ad Hoc Planning

For quick investigations, bug analysis, or exploratory work:

### Step 1: Enter Plan Mode
```
User: "Why is this function slow?"
Assistant: [Uses EnterPlanMode tool]
```

### Step 2: Investigation
- Profile code
- Analyze bottlenecks
- Document findings
- Plan stays in `.claude/plans/` automatically

### Step 3: Exit Plan Mode
- Call ExitPlanMode
- Plan remains in `.claude/plans/` (gitignored)
- No need to move or preserve

---

## File Naming Conventions

### Branch Plans: `docs/plans/v[X.Y]_[feature]_plan.md`

**Pattern:**
```
v{major}.{minor}_{feature_name}_plan.md
```

**Examples:**
```
v4.6_export_feature_plan.md
v4.5_action_verb_categorization_plan.md
v5.0_authentication_system_plan.md
v4.7_resume_templates_plan.md
v6.0_ai_model_switching_plan.md
```

**Rules:**
- Always include version number (must match branch version)
- Use underscores instead of hyphens in feature name
- Use lowercase for feature name
- Keep under 60 characters total
- Be descriptive but concise

### Ad Hoc Plans: `.claude/plans/[auto-generated].md`

**Examples:**
```
.claude/plans/stateless-coalescing-corbato.md
.claude/plans/debugging-performance.md
.claude/plans/investigation-2024-12-10.md
```

**Rules:**
- Auto-generated by Claude Code (don't manually create)
- Gitignored (not tracked)
- Can be deleted after session

---

## Integration with Documentation Update Protocol

When implementing a feature from a branch plan:

### Step 1: Reference Plan in /doc-update
When running `/doc-update` after implementation:
```markdown
### 6. docs/plans/v[X.Y]_[feature]_plan.md (This File)
**Action Required:**
- Mark as "‚úÖ Complete" in ROADMAP when finished
- Eventually consolidate into `v[X].x_consolidated_plans.md` after milestone
```

### Step 2: Update ROADMAP.md
```markdown
## v4.6.0 - Export/Download Feature
**Status:** ‚úÖ Complete
**Branch:** v4.6-export-feature
**Plan:** [docs/plans/v4.6_export_feature_plan.md](plans/v4.6_export_feature_plan.md)
**Merged:** 2025-12-15
```

### Step 3: Reference in Commit Messages
```bash
git commit -m "feat(v4.6): implement export functionality

- Added PDF, Markdown, JSON, HTML export formats
- Created js/export.js module with download utilities
- Integrated export menu into pipeline
- Added browser print API support for PDF

Ref: docs/plans/v4.6_export_feature_plan.md"
```

---

## Plan File Structure Template

All branch-specific plans should follow this structure:

```markdown
# [Feature Name] Implementation Plan

## Executive Summary
Brief overview of the feature and user request

## Current State Analysis
How things work now, what exists, what doesn't

## Proposed Solution
High-level approach to implementation

## Implementation Approach
Detailed phases/steps with code examples

## Technical Considerations
Important decisions, trade-offs, options

## File Structure
New files to create, existing files to modify

## Implementation Steps
Step-by-step guide (7-10 steps typical)

## User Experience Flow
How users will interact with the feature

## Edge Cases to Handle
Potential problems and solutions

## Success Criteria
Functional, quality, and UX requirements

## Documentation Updates Required
Which docs need updating (follows /doc-update protocol)

## Questions for User
Clarifications needed before implementation

## Risk Assessment
Low/medium/high risk areas with mitigation strategies
```

---

## Common Mistakes to Avoid

### ‚ùå Mistake 1: Leaving Plans in `.claude/plans/` for Branch Features
**Problem:** Branch-specific plans get lost, not tracked in git, no project documentation

**Solution:** Always move feature plans to `docs/plans/` before exiting plan mode

### ‚ùå Mistake 2: Committing `.claude/plans/` Files
**Problem:** Ad hoc investigation plans clutter the repository

**Solution:** `.claude/plans/` is gitignored - keep it that way

### ‚ùå Mistake 3: Inconsistent Naming
**Problem:** Plans are hard to find, don't match branch versions

**Solution:** Follow naming convention: `v[X.Y]_[feature]_plan.md`

### ‚ùå Mistake 4: Not Referencing Plans in ROADMAP
**Problem:** Plans become orphaned, hard to track what's implemented

**Solution:** Always link plans in ROADMAP.md and mark completion status

### ‚ùå Mistake 5: Deleting Plans After Implementation
**Problem:** Lose implementation context and decision rationale

**Solution:** Keep branch plans permanently in `docs/plans/` for reference

---

## Plan Lifecycle Management

### Active Development
```
docs/plans/v4.6_export_feature_plan.md
Status: üöß In Progress
Branch: v4.6-export-feature
ROADMAP: [ ] Pending
```

### Completed Feature
```
docs/plans/v4.6_export_feature_plan.md
Status: ‚úÖ Complete
Branch: v4.6-export-feature (merged to main)
ROADMAP: [x] Complete
```

### Major Version Consolidation
After completing all v4.x features:
```
docs/plans/v4.x_consolidated_plans.md
- Combines all v4.0 through v4.9 plans
- Individual plans preserved for reference
- Consolidated view for milestone documentation
```

---

## Quick Reference

| Plan Type | Location | Git Tracked | Lifecycle | Naming |
|-----------|----------|-------------|-----------|--------|
| Feature Branch | `docs/plans/` | ‚úÖ Yes | Permanent | `v[X.Y]_[feature]_plan.md` |
| Ad Hoc Investigation | `.claude/plans/` | ‚ùå No | Temporary | Auto-generated |
| Bug Fix | `.claude/plans/` | ‚ùå No | Temporary | Auto-generated |
| Exploration | `.claude/plans/` | ‚ùå No | Temporary | Auto-generated |

---

## Related Documentation

- **Documentation Update Workflow:** `docs/workflows/Documentation_Update_Workflow.md`
- **Documentation Update Protocol:** `docs/prompts/dev/Update_Doc_Prompt.md`
- **ROADMAP:** `docs/ROADMAP.md`
- **Lessons Learned:** `docs/lessons-learned/Lessons_Learned_Plan_File_Locations.md`

---

## Changelog

### v1.0 - 2025-12-10
- Initial creation
- Established plan file location standards
- Defined branch plan vs ad hoc plan distinction
- Created naming conventions and workflows
- Added integration with /doc-update protocol

---

**Last Updated:** 2025-12-10
**Applies To:** All Claude Code plan mode sessions
**Status:** Active SOP
