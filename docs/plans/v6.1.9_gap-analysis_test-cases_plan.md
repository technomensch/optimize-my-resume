# v6.1.9 Gap Analysis Test Cases - Patch Plan

**Version:** 6.1.9
**Branch:** `v6.1.9-gap-analysis_test-cases`
**Type:** Improvement/Enhancement
**Date:** 2025-12-30
**Status:** Complete

---

## Summary

Consolidate and expand test case coverage for Phases 2-4 by merging Sonnet's baseline tests with Opus expansions, corrections, and gap-filling tests. Additionally, add industry-standard skill priority weights (3:2:1 model) to scoring methodology across all relevant system files.

---

## Problem Statement

The existing test suite had gaps in Phase 2-4 coverage:
1. Sonnet's 32 baseline tests covered happy paths but missed edge cases
2. Logic errors existed in some test definitions (e.g., INC-004 index direction)
3. Boundary conditions were not tested (score = 30, confidence = 0.5)
4. Error recovery and blocking gate combinations were untested

---

## Changes

### Files Created

| File | Location | Description |
|------|----------|-------------|
| `phase-2-4-test-cases.md` | `docs/plans/testing/` | 79 merged test cases (Sonnet + Opus) |

### Files Modified

| File | Change |
|------|--------|
| `test-results.md` | Add execution results for new tests |
| `core/fit-thresholds.md` | Add skill-level priority weights (3:2:1 model) |
| `phases/phase-2/evidence-matching.md` | Update scoring formula with priority weights |
| `PROJECT-INSTRUCTIONS.md` | Add skill priority weights to scoring methodology |
| `quick-start-phase.md` | Add skill priority weights to scoring methodology |
| `docs/CHANGELOG.md` | Add v6.1.9 release notes |

---

## Detailed Change Rationale

### Issue Found: Missing Skill-Level Weights

**Discovery:** While creating test case FIX-008 (Required vs Preferred Weight Ratio), Opus identified that the system had **category-level weights** but **no skill-level weights**.

**Existing (Before v6.1.9):**
```xml
<scoring_methodology>
  <core_qualifications weight="50%">...</core_qualifications>
  <critical_requirements weight="30%">...</critical_requirements>
  <preferred_qualifications weight="20%">...</preferred_qualifications>
</scoring_methodology>
```

This defined weights for *categories* of requirements, but NOT for individual skills within those categories. The formula in `evidence-matching.md` was:
```
Scoring Method:
- Matched = 100% weight
- Partial = 50% weight
- Missing = 0% weight

Calculation: (10 * 1.0 + 3 * 0.5 + 3 * 0.0) / 16 = 0.72 = 72%
```

**Problem:** All skills treated equally regardless of importance:
- Missing "Python (Required)" = same impact as missing "Terraform (Preferred)"
- This doesn't match how recruiters evaluate candidates
- ATS systems typically weight required skills higher

**Solution:** Added 3:2:1 skill priority weights based on industry research:
- Required skills: 1.5x weight (priority 3)
- Preferred skills: 1.0x weight (priority 2)
- Optional skills: 0.5x weight (priority 1)

**Sources:**
- Rezi.ai ATS Resume Checker (uses 3:2:1 priority scoring)
- Recruiterflow: "10% change in weighting can shift scores by 5-8 points"
- Jobscan: 80% match rate target for resume optimization

---

## Specific Changes Per File

### 1. `core/fit-thresholds.md`

**Issue:** No skill-level priority weights defined.

**Added (Lines 65-101):**
```xml
### Skill-Level Priority Weights (v6.1.9)

<skill_priority_scoring>
  <!-- 3:2:1 Priority Model -->
  <required_skills priority="3" weight="1.5x">
    Skills explicitly marked as "Required", "Must have", or "Essential"
    Missing a required skill has 1.5x the negative impact of missing a preferred skill
  </required_skills>

  <preferred_skills priority="2" weight="1.0x">
    Skills marked as "Preferred", "Nice to have", or "Bonus"
    Baseline weight for gap calculations
  </preferred_skills>

  <optional_skills priority="1" weight="0.5x">
    Skills mentioned but not emphasized, inferred from context
    Half the impact of preferred skills
  </optional_skills>
</skill_priority_scoring>
```

Plus example calculation table and sources.

**Version Header Updated:** `<!-- Version: 5.0 -->` → `<!-- Version: 5.1 (v6.1.9 update) -->`

---

### 2. `phases/phase-2/evidence-matching.md`

**Issue:** Scoring formula treated all requirements equally.

**Before (Lines 381-388):**
```
Scoring Method:
- Matched = 100% weight
- Partial = 50% weight
- Missing = 0% weight

Calculation: (10 * 1.0 + 3 * 0.5 + 3 * 0.0) / 16 = 0.72 = 72%
```

**After (Lines 383-404):**
```
Scoring Method (v6.1.9 - Priority-Weighted):
- Matched = 100% of skill weight
- Partial = 50% of skill weight
- Missing = 0% of skill weight

Skill Priority Weights (3:2:1 Model):
- Required skills: 1.5x weight (priority 3)
- Preferred skills: 1.0x weight (priority 2)
- Optional/Inferred skills: 0.5x weight (priority 1)

Example Calculation:
| Skill | Status | Priority | Base Points | Weighted |
|-------|--------|----------|-------------|----------|
| Python (Required) | MATCHED | 3 | 10 | 15 pts |
| SQL (Required) | MATCHED | 3 | 10 | 15 pts |
| AWS (Preferred) | PARTIAL | 2 | 5 | 5 pts |
| Kubernetes (Preferred) | MISSING | 2 | 0 | 0 pts |
| Leadership (Required) | MATCHED | 3 | 10 | 15 pts |

Formula: (Sum of Weighted Points) / (Max Possible Weighted Points) × 100
```

**Version History Updated:** Added `v1.1 (2025-12-30): Added priority-weighted scoring formula`

---

### 3. `PROJECT-INSTRUCTIONS.md`

**Issue:** System prompt had category weights but no skill-level weights.

**Added after `<scoring_methodology>` block (Lines 391-397):**
```xml
<!-- v6.1.9: Skill-Level Priority Weights (3:2:1 Model) -->
<skill_priority_scoring>
  <required_skills priority="3" weight="1.5x">Skills marked "Required", "Must have", "Essential"</required_skills>
  <preferred_skills priority="2" weight="1.0x">Skills marked "Preferred", "Nice to have", "Bonus"</preferred_skills>
  <optional_skills priority="1" weight="0.5x">Skills inferred from context, not emphasized</optional_skills>
  <note>Missing a Required skill has 1.5x the negative impact of missing a Preferred skill. See core/fit-thresholds.md for full methodology.</note>
</skill_priority_scoring>
```

**Version Header Updated:**
- Line 1: `v6.1.7` → `v6.1.9`
- Line 6: Added `<!-- v6.1.9 Release: Skill priority weights (3:2:1 model), test case expansion (79 tests) -->`

---

### 4. `quick-start-phase.md`

**Issue:** Quick-start version also missing skill-level weights.

**Added same `<skill_priority_scoring>` block (Lines 135-141):**
```xml
<!-- v6.1.9: Skill-Level Priority Weights (3:2:1 Model) -->
<skill_priority_scoring>
  <required_skills priority="3" weight="1.5x">Skills marked "Required", "Must have", "Essential"</required_skills>
  <preferred_skills priority="2" weight="1.0x">Skills marked "Preferred", "Nice to have", "Bonus"</preferred_skills>
  <optional_skills priority="1" weight="0.5x">Skills inferred from context, not emphasized</optional_skills>
  <note>Missing a Required skill has 1.5x the negative impact of missing a Preferred skill.</note>
</skill_priority_scoring>
```

**Version Header Updated:** Line 1 and Line 6: `v6.1.7` → `v6.1.9`

---

### 5. `docs/CHANGELOG.md`

**Added v6.1.9 release notes (Lines 12-47)** with:
- **Added:** Skill Priority Weights, Expanded Test Suite
- **Changed:** Scoring Formula, System Instructions, Core Configuration
- **Fixed:** Sonnet Test Logic Errors (4 corrections)
- **Impact:** Summary of user benefits

### Test Case Additions

| Category | Count | Author | Focus |
|----------|-------|--------|-------|
| INT | 8 | Sonnet | Phase 2 Integration |
| INC | 10 | Sonnet | Incremental Updates |
| DIFF | 7 | Sonnet | Re-Comparison |
| SUM | 7 | Sonnet | Summary Generation |
| INTX | 8 | Opus | Extended Integration |
| INCX | 10 | Opus | Extended Incremental |
| DIFFX | 7 | Opus | Extended Diff |
| SUMX | 8 | Opus | Extended Summary |
| GATE | 7 | Opus | Blocking Gate Combinations |
| ERR | 7 | Opus | Error Recovery |
| FIX | 12 | Opus | Logic Corrections & Gaps |
| **Total** | **79** | | |

---

## Sonnet Logic Corrections Applied

| Original Test | Issue | Correction |
|---------------|-------|------------|
| INC-004 | Said indices "shifted up" | Corrected to "shifted DOWN" |
| SUM-005 | Used score 42 as threshold | Corrected to use gate threshold (<30) |
| INT-007 | No weight ratios specified | Added: Required = 1.5x Preferred |
| INT-006 | Confidence "> 0.5" ambiguous | Clarified: ">= 0.5" (inclusive) |

---

## Implementation Checklist

### Phase 1: Test Case Development
- [x] Review Sonnet's test cases for logic issues
- [x] Create Opus expanded test cases (INTX, INCX, DIFFX, SUMX, GATE, ERR)
- [x] Create FIX series for logic corrections and gaps
- [x] Merge all tests into consolidated file
- [x] Create patch plan document

### Phase 2: Skill Priority Weights
- [x] Add 3:2:1 skill priority weights to `core/fit-thresholds.md`
- [x] Update scoring formula in `phases/phase-2/evidence-matching.md`
- [x] Add skill priority weights to `PROJECT-INSTRUCTIONS.md`
- [x] Add skill priority weights to `quick-start-phase.md`

### Phase 3: Finalization
- [x] Create git branch (`v6.1.9-gap-analysis_test-cases`)
- [x] Execute P0/P1 priority tests
- [x] Update test results file
- [x] Update `docs/CHANGELOG.md` with v6.1.9 release notes
- [x] Commit and push final changes

---

## Test Execution Priority

| Priority | Tests | Rationale |
|----------|-------|-----------|
| P0 (Critical) | GATE-*, ERR-001 to ERR-003, FIX-004 to FIX-010 | Blocking gates, data integrity |
| P1 (High) | INT-*, INTX-001 to INTX-004, DIFF-001, DIFFX-001 | Core workflow |
| P2 (Medium) | INC-*, INCX-*, SUM-*, SUMX-* | Feature completeness |
| P3 (Low) | Remaining | Edge cases |

---

## Success Criteria

- [x] All 79 test cases documented in consolidated file
- [x] Logic corrections applied to Sonnet baseline
- [x] P0 and P1 tests executed with results recorded
- [x] No blocking issues identified
- [x] Skill priority weights added to all scoring files

---

## Related Files

### Test Documentation
- `docs/plans/testing/phase-1-test-cases.md` - Phase 1 JD parser tests (95+)
- `docs/plans/testing/phase-2-4-test-cases.md` - Phase 2-4 consolidated tests (79)
- `docs/plans/testing/test-results.md` - Test execution results

### Scoring Methodology Updates
- `core/fit-thresholds.md` - Skill priority weights definition
- `phases/phase-2/evidence-matching.md` - Scoring formula implementation
- `PROJECT-INSTRUCTIONS.md` - System prompt (full version)
- `quick-start-phase.md` - System prompt (quick start version)

### Release Documentation
- `docs/CHANGELOG.md` - Version history

---

## Skill Priority Weights (v6.1.9 Addition)

Based on industry ATS scoring best practices (Rezi.ai, Jobscan, Recruiterflow):

| Skill Type | Priority | Weight | Description |
|------------|----------|--------|-------------|
| Required | 3 | 1.5x | "Required", "Must have", "Essential" |
| Preferred | 2 | 1.0x | "Preferred", "Nice to have", "Bonus" |
| Optional | 1 | 0.5x | Inferred from context, not emphasized |

**Impact:** Missing a Required skill has 1.5x the negative impact of missing a Preferred skill.
