# v6.1.5 - Sonnet-Generated Test Cases (Phases 2-4)

This file contains 32 test cases generated by Sonnet to address gaps in the system's test coverage for Phases 2, 3, and 4.

---

## PART 10: Phase 2 Integration Flow Tests (Mode 1 → Mode 3)

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| INT-001 | Phase 1 → Phase 3 Data Flow | Job history v2.0 + JD | v2.0 job history loads correctly, hard/soft skills separated | Check: Evidence citations use "Company \| Job Title" format |
| INT-002 | v1.0 History Backward Compatibility | v1.0 job history + Phase 3 run | System loads v1.0, suggest upgrade, functions normally | Check: Evidence matching works with combined skills array |
| INT-003 | Missing Sections Handling | History with no education/certs | System marks those requirements as MISSING without error | Check: No null reference errors during analysis |
| INT-004 | Duplicate Skill Citations | Skill "Python" in 3 different roles | Evidence citations list all occurrences across all positions | Check: Multiple citations grouped per position |
| INT-005 | Overlapping Dates (Moonlighting) | Positions with overlapping date ranges | System don't double-count years of experience in aggregates | Check: Conservative aggregate calculation (max range) |
| INT-006 | Achievement-Based Inference | Achievement matches JD but skill not listed | Status set to INFERRED based on accomplishment context | Check: Citation points to achievement quote, confidence > 0.5 |
| INT-007 | Required vs Preferred Weighting | JD with mixed priority requirements | Status affects score proportionally based on priority | Check: Missing Required impacts score more than Missing Preferred |
| INT-008 | Blocking Gate Override | Trigger gate (e.g., low score) + User "yes" | System logs override and continues to recommendations | Check: Recommendations generated after confirmation |

---

## PART 11: Phase 3 Incremental Update Tests

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| INC-001 | Add Recent Position | Add new position (current) | Position inserted at index 1, others shifted down | Check: New position is first, dates are most recent |
| INC-002 | Add Chronological Position | Add position from 2016-2018 | Position inserted between 2019 and 2015 roles | Check: Position Index 3 (or correct position) updated |
| INC-003 | Edit Position Achievements | Update text in Position 2 | Only Position 2 modified, others preserved | Check: Version metadata updated, aggregates refreshed |
| INC-004 | Remove Position | Delete Position 4 | Position removed, indices 5+ shifted up | Check: Aggregate years of experience reduced correctly |
| INC-005 | Add Position (No Skills) | Position with empty skills list | Schema validation passes, matched as empty array | Check: Evidence matcher handles empty skills without error |
| INC-006 | Extend Position Duration | Update 2020-2022 to 2020-2023 | Aggregate years of experience increases by 1 | Check: `total_years` in metadata reflects change |
| INC-007 | Multiple Roles @ Same Company | Add new role at existing company | Both roles preserved with distinct titles/dates | Check: Citations show both roles: "Google \| SWE" & "Google \| Sr SWE" |
| INC-008 | Delete Last Position | Attempt to delete only position | System warns that history will be empty | Check: Require explicit confirmation for total deletion |
| INC-009 | Future Date Validation | Start date = 2026-01-01 | Rejects input with clear error message | Check: Error "Start date cannot be in the future" |
| INC-010 | Concurrent Operation | Add position while Phase 3 runs | System queues update or warns user | Check: State integrity maintained after both finish |

---

## PART 12: Phase 3 Re-Comparison & Diff Tests

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| DIFF-001 | Skill Improvement | Status: MISSING → MATCHED | Diff shows Python as an improvement | Check: "Improvements" section lists Python with status change |
| DIFF-002 | Re-comparison (No Change) | Run comparison with same files | Diff shows "No changes detected" | Check: Score delta = 0, no items in improvements/regressions |
| DIFF-003 | Score Delta Accuracy | 72% → 81% change | Displays +9 points improvement correctly | Check: Math matches (81 - 72 = 9) |
| DIFF-004 | Skill Regression | Status: MATCHED → PARTIAL | Diff shows regression with recommendation | Check: "Regressions" section lists SQL with explanation |
| DIFF-005 | Cache Version Mismatch | v1.0 Cache + v2.0 Schema | System re-parses JD using 17-point parser | Check: Warning "Outdated schema. Re-parsing..." shown |
| DIFF-006 | Schema Upgrade Diff | Upgrade history v1.0 → v2.0 | Diff notes structural enhancement | Check: "Job history upgraded" note appears in summary |
| DIFF-007 | Missing Cache Recovery | Delete `jd_parsed/` entry | System prompts for JD text re-upload | Check: Error "Cached JD not found" prompts for input |

---

## PART 13: Phase 4 Professional Summary Tests

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| SUM-001 | Master Summary (Multi-Role) | 3 roles in history | Generates 3-4 sentences with career aggregates | Check: Includes "8 years across 3 companies" phrasing |
| SUM-002 | Master Summary (Single Role) | 1 role in history | Adjusts phrasing to focus on depth at 1 company | Check: No plural "companies" if only one listed |
| SUM-003 | Per-JD Customization | JD keywords: Python, AWS | Substitutes generic hard skills with JD keywords | Check: "Expert in Python, AWS" replaces master skills |
| SUM-004 | Summary (No Metrics) | History with zero numbers | Omits metrics sentence gracefully, focus on scope | Check: No placeholder zeros or awkward blank spaces |
| SUM-005 | Low Fit Protection | Match Score = 42/100 | Does not offer customized per-JD summary | Check: Customization prompt skipped after analysis |
| SUM-006 | Length Constraint | Summary > 350 chars | Truncates at nearest sentence boundary | Check: Character count <= 350, no partial sentences |
| SUM-007 | Career Transition | Teacher → Engineer | Focuses on transferable skills (leadership, training) | Check: Highlights relevant bridge skills in summary |
