# Implementation Plan: v9.3.6-issue-85-layered-defense

**STATUS:** ðŸ”´ STOPPED (Waiting for Manual Approval of Step 1)
**GOVERNANCE:** Atomic Approval Required (Step-by-Step)
**BEHAVIOR LOCKS:**
- [x] Zero-Deviation Execution
- [x] Stop-on-Confusion (Interactive Gate)
- [x] Visible Result Validation (Post-Step Tables)

**Local ID:** issue-85
**GitHub Issue:** [#97](https://github.com/technomensch/optimize-my-resume/issues/97)
**Branch:** `v9.3.6-issue-85-layered-defense`
**Created:** 2026-01-30
**Assigned To:** Gemini (Implementation)

---

## Context

After production failure on Jan 29, 2026, documentation-based enforcement was proven insufficient. This plan implements the **Layered Defense Strategy** with multiple redundant enforcement mechanisms per platform.

**Key Insight:** Documentation-based enforcement is PASSIVE (can be ignored). This plan implements ACTIVE enforcement through:
- Human-in-the-loop gates
- User verification checklists
- Forced multi-turn structure
- Recency anchors

---

## Execution Protocol

1. **Present Logic:** Before every tool call, state the intended change and logic.
2. **Wait:** Request explicit "YES" to proceed.
3. **Execute:** Run the tool.
4. **Validate:** Display the Validation Check table (see below).

---

## Phase 1: Chat Interface Layers

### Step 1.1: Create Layered Enforcement Workflow

**File:** `docs/workflows/layered-enforcement-chat.md`

**Purpose:** Standalone workflow file with copy-paste ready prompts for each stage of bullet generation in chat interfaces.

**Contents:**
1. Stage 1 Prompt: Budget Planning ONLY (stop after table)
2. Stage 2 Prompt Template: Per-Position Generation (repeat for each position)
3. Stage 3 Prompt: Final Reconciliation
4. User verification checkpoints between each stage
5. Copy-paste validation prompts

**Reference:** Use prompts from [workflows.md Multi-Turn Enforcement](../knowledge/workflows.md#multi-turn-enforcement)

| Validation | Expected |
|------------|----------|
| File created | `docs/workflows/layered-enforcement-chat.md` |
| Contains Stage 1/2/3 prompts | YES |
| Contains user checkpoints | YES |
| Self-contained (no external dependencies) | YES |

---

### Step 1.2: Create User Verification Checklist

**File:** `docs/checklists/bullet-generation-verification.md`

**Purpose:** Standalone checklist user references BEFORE approving each stage.

**Contents:**
1. Pre-Generation Checklist (before Stage 1)
2. Budget Table Verification (after Stage 1)
3. Per-Position Verification (after each Stage 2)
4. Final Reconciliation Verification (after Stage 3)

**Reference:** Extract verification criteria from `bo_output-validator.md` SSOT

**Key Checks to Include:**
- [ ] Chronological order (newest first)
- [ ] Bullet count matches allocation
- [ ] Character limits (100-210)
- [ ] No gerunds (starting verbs)
- [ ] Verb category diversity
- [ ] No metric fabrication
- [ ] Word budget compliance

| Validation | Expected |
|------------|----------|
| File created | `docs/checklists/bullet-generation-verification.md` |
| References SSOT | `bo_output-validator.md` |
| Covers all 3 stages | YES |
| User-readable format | YES |

---

### Step 1.3: Test Chat Interface Workflow

**Action:** Dry-run the workflow in Claude Chat with a sample JD.

**Success Criteria:**
- User can follow workflow without external guidance
- Each stage produces expected output format
- User verification catches at least one violation

---

## Phase 2: Claude Project Layers

### Step 2.1: Create Minimized Claude Project Prompt

**File:** `optimization-tools/bullet-optimizer/bo_claude-project-prompt.md`

**Purpose:** Minimal instructions for Claude Project use that reduces context saturation.

**Contents:**
1. Essential guardrails ONLY (top 10 most critical)
2. Output format template
3. Recency anchor at end
4. Reference to full validator for user verification

**Design Principle:** Less context = higher attention weight per instruction

| Validation | Expected |
|------------|----------|
| File created | `bo_claude-project-prompt.md` |
| Line count | < 200 lines |
| Contains recency anchor | YES |
| References user checklist | YES |

---

### Step 2.2: Update bo_bullet-generation-instructions.md

**File:** `optimization-tools/bullet-optimizer/bo_bullet-generation-instructions.md`

**Changes:**
1. Add recency anchor section at END of file
2. Add reference to user verification checklist
3. Add "STOP AND VERIFY" instruction between stages

**Recency Anchor Template:**
```markdown
---
## âš ï¸ CRITICAL: READ BEFORE GENERATING (RECENCY ANCHOR)

Before generating ANY bullets, you MUST:
1. Output Budget Allocation Table FIRST
2. STOP and wait for user approval
3. Generate ONE position at a time
4. User verifies against checklist before continuing

DO NOT generate all positions at once.
DO NOT skip the Budget Allocation Table.
DO NOT claim compliance without showing evidence.
---
```

| Validation | Expected |
|------------|----------|
| Recency anchor added | END of file |
| User checkpoint references | YES |
| Stop instructions clear | YES |

---

### Step 2.3: Update bo_output-validator.md

**File:** `optimization-tools/bullet-optimizer/bo_output-validator.md`

**Changes:**
1. Add "User Verification Format" section
2. Format checks as user-readable checklist
3. Add "Copy this section for manual verification"

| Validation | Expected |
|------------|----------|
| User verification section added | YES |
| Format is user-readable | YES |
| Can be copy-pasted | YES |

---

### Step 2.4: Test Claude Project Workflow

**Action:** Test full generation in Claude Project with minimized context.

**Success Criteria:**
- Context saturation reduced (fewer attached files)
- Output follows expected format
- User verification catches violations

---

## Phase 3: Validation & Documentation

### Step 3.1: Update Knowledge Graph

**Files to update:**
- `docs/knowledge/workflows.md` - Add reference to new workflow file
- `docs/knowledge/index.md` - Update entry counts

---

### Step 3.2: Update Session Summary

Add implementation completion to session summary.

---

## Final Reconciliation Table

| Phase | Step | Status | Notes |
|-------|------|--------|-------|
| 1 | 1.1 Create layered-enforcement-chat.md | [ ] | |
| 1 | 1.2 Create bullet-generation-verification.md | [ ] | |
| 1 | 1.3 Test Chat Interface | [ ] | |
| 2 | 2.1 Create bo_claude-project-prompt.md | [ ] | |
| 2 | 2.2 Update bo_bullet-generation-instructions.md | [ ] | |
| 2 | 2.3 Update bo_output-validator.md | [ ] | |
| 2 | 2.4 Test Claude Project | [ ] | |
| 3 | 3.1 Update Knowledge Graph | [ ] | |
| 3 | 3.2 Update Session Summary | [ ] | |

---

## Related Documentation

- **Issue Description:** [issue-85-description.md](../issues/issue-85/issue-85-description.md)
- **Solution Approach:** [solution-approach.md](../issues/issue-85/solution-approach.md)
- **Pattern:** [Layered Defense Strategy](../knowledge/patterns.md#layered-defense-strategy)
- **Incident Analysis:** [ENFORCEMENT_FAILURE_ANALYSIS_AND_SOLUTIONS.md](../knowledge/ENFORCEMENT_FAILURE_ANALYSIS_AND_SOLUTIONS.md)

---

**DOCUMENTATION COMPLETE. I have ENGAGED the implementation freeze. Read this plan and say 'Execute Step 1.1' when you have reviewed and approved the logic. I will not proceed until then.**
