# Plan: v9.2.6 Fix Exact Matching in validateChronologyDepth

**Issue:** #79 - Bullets not rendering (Attempt 4)
**Status:** Ready for Implementation
**Created:** 2026-01-25
**Planner:** Claude Opus 4.5

---

## Problem Summary

Console shows:
- `success: false`
- `errorCount: 2` (NOT the empty bullets error)
- `attempts: 3`

**LLM IS generating bullets**, but they're being filtered out by `validateChronologyDepth`.

---

## Root Cause

**Inconsistent matching between validators:**

| Validator | Line | Matching | Result |
|-----------|------|----------|--------|
| `validateChronologyDepth` | 118 | **EXACT string** | Filters out positions |
| `validatePositionMetadata` | 146 | **Fuzzy** (`findBestMatch`) | Would preserve them |

**Execution order:** ChronologyDepth runs FIRST and filters. By the time MetadataValidator runs, positions are gone.

**Example failure:**
- LLM generates: `"Sr. Software Engineer"`
- Job history has: `"Senior Software Engineer"`
- ChronologyDepth exact match fails → position filtered out
- MetadataValidator fuzzy match would pass → but position already removed

---

## Implementation Tasks

### Task 1: Update extraPositions check (lines 89-98)

**File:** `src/validators/bullet-generation/core-validators.js`

**Change from:**
```javascript
const extraPositions = customizedBullets.filter(cb => {
    const matchingJob = jobHistory.find(jh =>
        jh.position.toLowerCase().trim() === cb.position.toLowerCase().trim()
    );
    if (!matchingJob) return true;
```

**Change to:**
```javascript
const extraPositions = customizedBullets.filter(cb => {
    const matchingJob = findBestMatch(cb.position, jobHistory);
    if (!matchingJob) return true;
```

### Task 2: Update filteredBullets check (lines 117-121)

**Change from:**
```javascript
const filteredBullets = intermediateBullets.filter(cb => {
    const matchingJob = jobHistory.find(jh =>
        jh.position.toLowerCase().trim() === cb.position.toLowerCase().trim()
    );
    if (!matchingJob) return false;
```

**Change to:**
```javascript
const filteredBullets = intermediateBullets.filter(cb => {
    const matchingJob = findBestMatch(cb.position, jobHistory);
    if (!matchingJob) return false;
```

### Task 3: Update eligibility check (lines 123-125)

**Change from:**
```javascript
return eligiblePositions.some(ep =>
    ep.position.toLowerCase().trim() === cb.position.toLowerCase().trim()
);
```

**Change to:**
```javascript
const matchedEligible = findBestMatch(cb.position, eligiblePositions);
return matchedEligible !== null;
```

---

## Files to Modify

| File | Change |
|------|--------|
| `src/validators/bullet-generation/core-validators.js` | 3 locations - replace exact match with `findBestMatch` |

---

## Verification

1. [ ] Console shows `success: true` or lower `errorCount`
2. [ ] Customized Bullets section displays positions
3. [ ] Position titles auto-corrected to match job history
4. [ ] Works with abbreviated titles ("Sr." vs "Senior")

---

## Commit Message

```bash
git commit -m "fix(v9.2.6): use fuzzy matching in validateChronologyDepth

Issue #79 Attempt-4: Fix positions filtered due to exact matching

- core-validators.js: Replace exact string matching with findBestMatch
- 3 locations updated for consistent fuzzy matching
- Aligns with validatePositionMetadata behavior

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```
