# Plan: v9.2.5 Issue #79 Null-Coalescing Fix (Attempt-3)

**Issue:** #79 - GUI Customized Bullets Using Wrong Context
**Branch:** `v9.2.5-issue-79-attempt-3`
**Status:** Ready for Implementation
**Created:** 2026-01-25
**Planner:** Claude Opus 4.5

---

## Problem Summary

**Symptom:** Customized Bullets section is empty, Professional Summary displays correctly.

**Root Cause:** `validator-pipeline.js:75` has no null check on `parsedContent.customizedBullets`.

**Failure Chain:**
1. LLM returns response without `customizedBullets` (or undefined)
2. `correctedBullets` becomes `undefined`
3. `validateChronologyDepth()` tries `.map()` on undefined â†’ silent crash
4. Pipeline returns `customizedBullets: undefined`
5. JSX `?.length` check renders nothing

**Why Summary works but Bullets don't:**
Summary validators use `parsedContent.professionalSummary` directly. Bullet validators depend on `correctedBullets` being initialized first.

---

## Implementation Tasks

### Task 1: Add null-coalescing (CRITICAL)
**File:** `src/validators/bullet-generation/validator-pipeline.js`
**Line:** 75

**Change from:**
```javascript
let correctedBullets = parsedContent.customizedBullets;
```

**Change to:**
```javascript
let correctedBullets = parsedContent.customizedBullets || [];
```

### Task 2: Add guard clause for empty bullets (HIGH)
**File:** `src/validators/bullet-generation/validator-pipeline.js`
**Location:** After line 75 (after null-coalescing)

**Insert:**
```javascript
if (correctedBullets.length === 0) {
    return {
        valid: false,
        errors: [{ type: 'EMPTY_CUSTOMIZED_BULLETS', message: 'LLM returned no customized bullets', requiresRegeneration: true }],
        correctedContent: parsedContent,
        summary: { totalValidators: 0, errorsFound: 1 }
    };
}
```

### Task 3: Add defensive check in core validator (HIGH)
**File:** `src/validators/bullet-generation/core-validators.js`
**Location:** Start of `validateChronologyDepth()` function (after line 45)

**Insert:**
```javascript
if (!customizedBullets || !Array.isArray(customizedBullets)) {
    return { valid: false, errors: [{ type: 'INVALID_INPUT', message: 'customizedBullets is not an array' }], correctedBullets: [], eligiblePositions: [] };
}
```

---

## Files to Modify

| File | Change | Priority |
|------|--------|----------|
| `src/validators/bullet-generation/validator-pipeline.js:75` | Add `|| []` + guard clause | CRITICAL |
| `src/validators/bullet-generation/core-validators.js:45` | Add defensive array check | HIGH |

---

## Verification Criteria

Run the app and test:
1. [ ] Generation triggers without errors
2. [ ] Professional Summary displays
3. [ ] **All positions with bullets appear** (the critical fix)
4. [ ] Company names from history (not JD)
5. [ ] Console shows validation structure (no undefined errors)

---

## Commit Message

```bash
git add -A && git commit -m "fix(v9.2.5): add null-coalescing for customizedBullets

Issue #79 Attempt-3: Fix bullets not rendering

- validator-pipeline.js: Add || [] fallback at line 75
- validator-pipeline.js: Add guard clause for empty bullets
- core-validators.js: Add defensive array check in validateChronologyDepth

Root cause: parsedContent.customizedBullets was undefined, causing
silent crash in validation pipeline. Bullets section rendered empty
while Summary worked (different code path).

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```

---

## Version History Context

| Version | Status | Scope | Issue |
|---------|--------|-------|-------|
| v9.2.1 | Complete | Prompt changes | Bullets not displaying |
| v9.2.2 | Complete | 25 validators | 3 bugs remained |
| v9.2.3 | Complete | Modularization (8 modules) | Organizational |
| v9.2.4 | Complete | Bug fixes (company, positions) | Issue persists |
| **v9.2.5** | **CURRENT** | Null-coalescing | Attempt-3 |

---

## Gemini Handoff Instructions

### Context
You are implementing v9.2.5 for Issue #79 - the third attempt to fix bullets not rendering.

**Previous attempts summary:**
- v9.2.1-v9.2.4 fixed many issues but bullets still don't render
- The core issue: `validator-pipeline.js:75` lacks null handling
- Summary displays correctly (different code path), bullets are empty

### Pre-Requisites
1. Branch `v9.2.5-issue-79-attempt-3` already exists
2. Documentation already updated (implementation-log.md, GitHub issue)
3. All previous v9.2.x changes are in place (uncommitted)

### Your Tasks (In Order)

**1. Apply Fix 1 - Null-coalescing:**
```bash
# File: src/validators/bullet-generation/validator-pipeline.js
# Line 75: Change from:
let correctedBullets = parsedContent.customizedBullets;
# To:
let correctedBullets = parsedContent.customizedBullets || [];
```

**2. Apply Fix 2 - Guard clause (insert after line 75):**
```javascript
if (correctedBullets.length === 0) {
    return {
        valid: false,
        errors: [{ type: 'EMPTY_CUSTOMIZED_BULLETS', message: 'LLM returned no customized bullets', requiresRegeneration: true }],
        correctedContent: parsedContent,
        summary: { totalValidators: 0, errorsFound: 1 }
    };
}
```

**3. Apply Fix 3 - Defensive check in core-validators.js:**
```bash
# File: src/validators/bullet-generation/core-validators.js
# At start of validateChronologyDepth() function (after line 45), insert:
```
```javascript
if (!customizedBullets || !Array.isArray(customizedBullets)) {
    return { valid: false, errors: [{ type: 'INVALID_INPUT', message: 'customizedBullets is not an array' }], correctedBullets: [], eligiblePositions: [] };
}
```

**4. Test locally:**
- Run the app
- Test bullet generation with a job description
- Verify all 5 criteria pass (see Verification Criteria above)

**5. Commit (if tests pass):**
Use the commit message from "Commit Message" section above.

### Critical Constraints
- Do NOT modify any other files
- Do NOT add features or improvements
- Do NOT refactor existing code
- ONLY apply the 3 fixes specified

### If Tests Fail
1. Check console for errors
2. Document the failure in implementation-log.md
3. Do NOT attempt additional fixes without user approval

---

## Reference Documentation

- [Implementation Log](../issues/issue-79/implementation-log.md)
- [v9.2.4 Plan](v9.2.4-issue-79-bug-fixes.md)
- [v9.2.3 Modularization](v9.2.3-modularization.md)
- [GitHub Issue #79](https://github.com/technomensch/optimize-my-resume/issues/79)
