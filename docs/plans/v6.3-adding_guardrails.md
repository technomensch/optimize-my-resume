# Guardrail & Validation Suggestions v2.0

Based on your request, I have refined the validation suggestions into specific, actionable guardrail instructions that can be directly integrated into the system's prompt architecture.

## 1. Metric Isolation & Traceability

> **Implementation Target:** Add to [job-history-v2-creation.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/job-history-v2-creation.md) (primary) and [evidence-matching.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-2/evidence-matching.md) (secondary).

### Specific Guardrail: The "Source-to-Output" Traceability Rule
**Instruction Text:**
```xml
<metric_traceability_guardrail>
  <instruction>
    For every numeric metric or specific achievement included in the output, you must perform an internal "source-check" before finalizing the draft.
  </instruction>
  <verification_steps>
    1. Identify the Job ID (Position N) for which you are writing.
    2. Scan ONLY the <position id="N"> block in the source job history.
    3. If the metric appears in any other position block, but NOT in block N, it is a HALLUCINATION and must be removed.
    4. Provide an internal "thinking" citation: [Metric X traced to Position N].
  </verification_steps>
</metric_traceability_guardrail>
```

---

## 2. Chronological Integrity

> **Implementation Target:** Add to [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) (primary, within `<position_ordering>` section) and [PROJECT-INSTRUCTIONS.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/PROJECT-INSTRUCTIONS.md) (secondary).

### Specific Guardrail: Mandatory Pre-Draft Sorting Logic
**Instruction Text:**
```xml
<chronological_validation_guardrail>
  <priority>CRITICAL</priority>
  <pre_draft_step>
    Before drafting ANY position content, generate a "Sort Validation Table" in your internal thinking process:
    | Role Rank | Position ID | End Date | Start Date |
    |-----------|-------------|----------|------------|
    | 1 (Newest)| [ID]        | [Date]   | [Date]     |
    | 2         | [ID]        | [Date]   | [Date]     |
    
    Rule: Sort Order must be 'End Date' DESCENDING. If any End Date is later than the End Date of the position above it, the sort is invalid.
  </pre_draft_step>
</chronological_validation_guardrail>
```

---

## 3. Professional Summary Abstraction

> **Implementation Target:** Add to [summary-generation.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-4/summary-generation.md).

### Specific Guardrail: The 50/50 "Anti-Mirror" Rule
**Instruction Text:**
```xml
<summary_abstraction_guardrail>
  <instruction>
    The Professional Summary must function as an "Executive Synthesis," not a "Bullet Echo."
  </instruction>
  <constraints>
    - <constraint id="no_mirroring">No sentence in the summary can share more than 50% of its keywords with any single bullet point in the resume.</constraint>
    - <constraint id="synthesis_requirement">At least one sentence must synthesize metrics across multiple roles (e.g., "Led projects across [Industry A] and [Industry B], achieving [Cumulative Metric]").</constraint>
    - <constraint id="impact_first">Start sentences with the "Outcome" (The Why) rather than the "Action" (The How) to differentiate from bullets.</constraint>
  </constraints>
</summary_abstraction_guardrail>
```

---

## 4. Extended Validation Checks

> **Implementation Target:** Add to [metrics-requirements.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/metrics-requirements.md).

### Specific Guardrail: Rule-Metric Compatibility Heuristic
**Instruction Text:**
```xml
<validity_heuristic_check>
  <instruction>
    Perform a "Common Sense Audit" on metric-role pairings.
  </instruction>
  <audit_questions>
    - "Does it make sense for a [User_Role] to be personally responsible for [Result X]?"
    - "Is this metric too specific to a different job category (e.g., code coverage metrics in a PM role)?"
    - "If the metric is for a government role, does it strictly adhere to the Job History limitations for that specific agency?"
  </audit_questions>
</validity_heuristic_check>
```

---

---

# Part 2: Additional Guardrail Suggestions (Second Pass)

Upon further review, the following additional guardrails are proposed to strengthen data integrity and consistency.

## 5. honest_limitations Enforcement

> **Implementation Target:** Add to [evidence-matching.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-2/evidence-matching.md) (primary) and [job-history-v2-creation.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/job-history-v2-creation.md) (secondary).

### Specific Guardrail: The "Limitation Cross-Check"
To prevent the system from accidentally hallucinating a skill that the user explicitly listed as a "limitation" or "unknown" in an earlier phase.

**Instruction Text:**
```xml
<limitation_enforcement_guardrail>
  <priority>CRITICAL</priority>
  <instruction>
    Before finalizing any bullet point, cross-reference the generated content against the <honest_limitations> section of the target Position.
  </instruction>
  <logic>
    IF generated_bullet mentions [Skill X]
    AND <honest_limitations> contains "No experience with [Skill X]" OR "Limited exposure to [Skill X]"
    THEN:
      1. Flag as CONTRADICTION.
      2. Remove the claim or rephrase to match the limitation (e.g., "exposed to" instead of "expert in").
  </logic>
</limitation_enforcement_guardrail>
```

---

## 6. Data Loss Prevention during Updates

> **Implementation Target:** Add to [incremental-updates.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-3/incremental-updates.md).

### Specific Guardrail: The "Volume Preservation" Check
When performing "Surgical Updates" (Phase 3 Incremental Updates), there is a risk of accidentally truncating existing content.

**Instruction Text:**
```xml
<data_loss_prevention_protocol>
  <trigger>When executing /update-history or modifying existing positions</trigger>
  <verification_step>
    Compare the "Item Count" of the original vs. the new draft.
    
    Rule:
    - New `core_responsibilities` count >= Original count (unless deletion explicitly requested).
    - New `key_achievements` count >= Original count.
    
    IF New count < Original count:
      STOP and verify: "Did you intend to remove [Missing Item]?"
  </verification_step>
</data_loss_prevention_protocol>
```

---

## 7. Skill Categorization Consistency

> **Implementation Target:** Add to [jd-parsing-17-point.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/jd-parsing-17-point.md) (primary) and [verb-categories.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/verb-categories.md) (secondary).

### Specific Guardrail: Mutual Exclusivity Check
To ensure clean data separation between Hard and Soft skills.

**Instruction Text:**
```xml
<skill_classification_guardrail>
  <instruction>
    A single skill term cannot exist in both <hard_skills_demonstrated> and <soft_skills_demonstrated> within the same position.
  </instruction>
  <auto_correction>
    IF duplicates found:
    - Technical/Tools/Hard Skills -> Keep in <hard_skills_demonstrated>, remove from Soft.
    - Behavioral/Leadership/Interpersonal -> Keep in <soft_skills_demonstrated>, remove from Hard.
  </auto_correction>
</skill_classification_guardrail>
```

# Part 3: Additional Guardrail Suggestions (Third Pass - Claude)

After reviewing the existing guardrails and the full instruction set, I've identified several additional validation opportunities that focus on **quantitative constraints**, **position-level validation**, and **JD-specific quality checks**.

## 8. Character and Word Count Enforcement

> **Implementation Target:** Add to [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) within **EXISTING** `<quality_assurance_rules>` section (lines 11-50). **Do not create a new section.**

### Specific Guardrail: The "Budget Compliance" Gate
The system has clear limits (100-210 chars per bullet, 350-500 words total), but there's no explicit pre-output validation to enforce these.

**Instruction Text:**
```xml
<budget_enforcement_guardrail>
  <priority>HIGH</priority>
  <trigger>Before presenting final output</trigger>
  
  <per_bullet_validation>
    FOR EACH bullet:
      IF character_count < 100 OR character_count > 210:
        FLAG as "Out of range" and REGENERATE
        
    RULE: Zero tolerance for bullets outside 100-210 character range
  </per_bullet_validation>
  
  <total_word_count_validation>
    total_words = SUM(all_bullets.word_count)
    
    IF total_words > 500:
      STOP and apply reduction strategy:
        1. Identify oldest/weakest positions (4+ back)
        2. Reduce bullets from 3→2 or 2→1 for those positions
        3. Recalculate until total_words <= 500
        
    IF total_words < 350:
      FLAG as "Underutilized" - consider adding bullets to strongest positions
  </total_word_count_validation>
</budget_enforcement_guardrail>
```

---

## 9. Verb Diversity Per-Position Enforcement

> **Implementation Target:** Add to [verb-categories.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/verb-categories.md) (primary) and [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) (secondary).

### Specific Guardrail: The "No Repeat Category" Rule
The current `verb_diversity_rule` says to "maximize diversity" but doesn't explicitly prevent same-category repetition **within a single position**.

**Instruction Text:**
```xml
<position_verb_diversity_guardrail>
  <priority>HIGH</priority>
  <instruction>
    Within a SINGLE position, no verb category may be used more than once.
  </instruction>
  
  <validation_logic>
    FOR EACH position:
      verb_categories_used = []
      
      FOR EACH bullet in position:
        category = identify_verb_category(bullet)
        
        IF category IN verb_categories_used:
          FLAG as "Duplicate category in position [N]"
          REGENERATE bullet using different category
        ELSE:
          verb_categories_used.append(category)
  </validation_logic>
  
  <exception>
    If position has 5+ bullets, allow ONE category to repeat (but still prefer diversity)
  </exception>
</position_verb_diversity_guardrail>
```

---

## 10. JD Keyword Density Validation

> **Implementation Target:** Add to [jd-parsing-17-point.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/jd-parsing-17-point.md) (primary) and [re-comparison.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-3/re-comparison.md) (secondary).

### Specific Guardrail: The "Keyword Saturation" Check
To prevent keyword stuffing while ensuring adequate coverage.

**Instruction Text:**
```xml
<keyword_density_guardrail>
  <priority>MODERATE</priority>
  <instruction>
    Validate that JD keywords are distributed naturally across bullets and summary.
  </instruction>
  
  <density_rules>
    <rule id="no_stuffing">
      No single bullet should contain more than 3 distinct JD keywords.
      IF bullet contains 4+ keywords: FLAG as "Keyword stuffing" and rephrase
    </rule>
    
    <rule id="minimum_coverage">
      Target: 8-12 unique JD keywords across entire output
      IF unique_keywords < 8: FLAG as "Insufficient keyword coverage"
    </rule>
    
    <rule id="natural_distribution">
      No keyword should appear more than 2 times across all bullets
      (Exception: Core role keywords that appear 5+ times in JD)
    </rule>
  </density_rules>
</keyword_density_guardrail>
```

---

## 11. Metrics Authenticity Cross-Check

> **Implementation Target:** Add to [metrics-requirements.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/metrics-requirements.md).

### Specific Guardrail: The "Plausibility Filter"
Beyond just checking if metrics exist in job history, validate they make logical sense.

**Instruction Text:**
```xml
<metric_plausibility_guardrail>
  <priority>HIGH</priority>
  <instruction>
    Apply common-sense validation to numeric claims before output.
  </instruction>
  
  <plausibility_checks>
    <check id="percentage_range">
      All percentages must be 0-100%
      IF percentage > 100%: FLAG as "Implausible percentage"
    </check>
    
    <check id="time_savings">
      Time reduction claims must show valid before/after
      IF "reduced from X to Y" AND Y > X: FLAG as "Inverted time metric"
    </check>
    
    <check id="team_size_consistency">
      Team size should be consistent with role level
      IF role = "Junior" AND team_size > 10: FLAG for review
      IF role = "Senior/Lead" AND team_size = 0: FLAG as "Missing leadership scope"
    </check>
    
    <check id="currency_format">
      All currency values must include $ symbol and reasonable magnitude
      IF revenue_claim > $1B for individual contributor: FLAG for review
    </check>
  </plausibility_checks>
</metric_plausibility_guardrail>
```

---

## 12. Position Recency Weighting

> **Implementation Target:** Add to [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) within `<bullet_count_per_position>` section.

### Specific Guardrail: The "Freshness Priority" Rule
Ensure most recent positions get the most detailed treatment.

**Instruction Text:**
```xml
<recency_weighting_guardrail>
  <priority>MODERATE</priority>
  <instruction>
    Allocate bullets based on position recency and JD relevance.
  </instruction>
  
  <allocation_rules>
    <rule id="position_1_priority">
      Position 1 (most recent) should have:
        - Minimum 3 bullets
        - At least 2 quantified metrics
        - Strongest JD keyword matches
    </rule>
    
    <rule id="position_4_plus_constraint">
      Positions 4+ (older roles) should have:
        - Maximum 2 bullets (unless exceptionally relevant to JD)
        - Only include if directly relevant to JD requirements
    </rule>
    
    <validation>
      IF Position 1 has fewer bullets than Position 3+:
        FLAG as "Inverted recency priority" and rebalance
    </validation>
  </allocation_rules>
</recency_weighting_guardrail>
```

---

## 13. Summary-to-Bullets Metric Reconciliation

> **Implementation Target:** Add to [summary-generation.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-4/summary-generation.md).

### Specific Guardrail: The "Metric Consistency" Check
Ensure metrics mentioned in summary are actually supported by bullets.

**Instruction Text:**
```xml
<summary_metric_reconciliation_guardrail>
  <priority>HIGH</priority>
  <instruction>
    Every quantified claim in the Professional Summary must be traceable to at least one bullet point.
  </instruction>
  
  <validation_process>
    1. Extract all metrics from Professional Summary (e.g., "10 years", "$5M", "500K+ users")
    2. FOR EACH metric in summary:
         Search all bullets for supporting evidence
         IF metric NOT found in any bullet:
           FLAG as "Unsupported summary claim"
           Options:
             A) Add supporting bullet
             B) Remove metric from summary
             C) Verify metric exists in job history and add to bullets
  </validation_process>
  
  <exception>
    Years of experience can be calculated from position dates without explicit bullet mention
  </exception>
</summary_metric_reconciliation_guardrail>
```

---

## 14. Automatic Quality Gate Iteration Limit

> **Implementation Target:** Add to [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) (primary, within **EXISTING** `<quality_assurance_rules>` section, lines 11-50, specifically enhance the `<automatic_quality_gate>` subsection) and [PROJECT-INSTRUCTIONS.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/PROJECT-INSTRUCTIONS.md) (secondary). **Do not create a new section.**

### Specific Guardrail: The "Infinite Loop Prevention" Safety
The current `automatic_quality_gate` has a 3-iteration limit but doesn't specify what happens if fundamental issues persist.

**Instruction Text:**
```xml
<quality_gate_failure_protocol>
  <priority>CRITICAL</priority>
  <instruction>
    If quality gate fails after 3 iterations, provide diagnostic output to user.
  </instruction>
  
  <failure_handling>
    IF iterations >= 3 AND issues_remain:
      STOP regeneration loop
      
      OUTPUT to user:
        "⚠️ Quality Gate Alert
        
        After 3 regeneration attempts, the following issues persist:
        - [List specific issues: e.g., 'Position 2 has duplicate verb categories']
        - [List specific issues: e.g., 'Bullet 5 exceeds 210 character limit']
        
        This may indicate:
        1. Insufficient content in job history for this position
        2. JD requirements conflict with available experience
        3. Need for manual refinement
        
        Would you like me to:
        A) Present best attempt with warnings
        B) Skip this position
        C) Ask clarifying questions about [specific issue]"
  </failure_handling>
</quality_gate_failure_protocol>
```

---

## Summary of Third-Pass Additions

These 7 additional guardrails address:

1. **Quantitative Enforcement** (#8): Hard limits on character/word counts
2. **Position-Level Validation** (#9): Verb diversity within single positions
3. **Keyword Quality** (#10): Preventing stuffing while ensuring coverage
4. **Metric Plausibility** (#11): Common-sense validation of numeric claims
5. **Recency Logic** (#12): Ensuring newest positions get priority
6. **Cross-Reference Validation** (#13): Summary metrics must appear in bullets
7. **Failure Handling** (#14): Graceful degradation when quality gates fail repeatedly

These complement the earlier guardrails by adding **enforcement mechanisms** and **failure protocols** that were implicit but not explicitly defined.

# Part 4: Additional Guardrail Suggestions (Fourth Pass - Claude Extended Thinking)

After deep analysis of the instruction set and existing guardrails, I've identified critical gaps in **cross-phase consistency**, **phrase repetition enforcement**, **attribution accuracy**, and **skill inventory misuse**.

## 15. Phrase Repetition Enforcement

> **Implementation Target:** Add to [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) within **EXISTING** `<quality_assurance_rules>` section (lines 11-50). **Do not create a new section.**

### Specific Guardrail: The "Maximum-2-Occurrences" Scanner
The `phrase_variation_rule` states "maximum 2 times across entire resume" but there's no automated enforcement.

**Instruction Text:**
```xml
<phrase_repetition_enforcement_guardrail>
  <priority>HIGH</priority>
  <instruction>
    Scan ALL bullets and summary for repeated multi-word phrases (3+ words).
  </instruction>
  
  <detection_logic>
    1. Extract all 3+ word sequences from bullets and summary
    2. Normalize: lowercase, remove punctuation
    3. Count occurrences of each sequence
    4. IF any sequence appears 3+ times:
         FLAG as "Excessive repetition: '[phrase]' appears [N] times"
         APPLY variation strategies from phrase_variation_rule
  </detection_logic>
  
  <variation_requirements>
    FOR sequences appearing 3+ times:
      - Keep in strongest/most-impactful position only
      - Replace in other positions with different achievements from those job histories
      - OR apply verb/format/structure variation strategies
  </variation_requirements>
  
  <example_phrases_to_track>
    - "version control"
    - "0% to 100%"
    - "reduced from X to Y"
    - "led team of"
    - "implemented system"
  </example_phrases_to_track>
</phrase_repetition_enforcement_guardrail>
```

---

## 16. Master Skills Inventory Quarantine

> **Implementation Target:** Add to [PROJECT-INSTRUCTIONS.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/PROJECT-INSTRUCTIONS.md) (primary) and [evidence-matching.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-2/evidence-matching.md) (secondary).

### Specific Guardrail: The "Position-Evidence-Only" Rule
Prevents using `master_skills_inventory` when position-specific evidence is required.

**Instruction Text:**
```xml
<master_skills_quarantine_guardrail>
  <priority>CRITICAL</priority>
  <instruction>
    When generating bullets for Position N, ONLY use evidence from that position's sections.
    master_skills_inventory is QUARANTINED from bullet generation.
  </instruction>
  
  <allowed_sources_for_bullet_generation>
    FOR Position N bullets, ONLY reference:
      - position[N].tools_technologies
      - position[N].hard_skills_demonstrated
      - position[N].soft_skills_demonstrated
      - position[N].key_achievements
      - position[N].core_responsibilities
  </allowed_sources_for_bullet_generation>
  
  <forbidden_sources>
    NEVER reference for bullet generation:
      - master_skills_inventory (too generic, no position evidence)
      - Other positions' skills (cross-contamination)
  </forbidden_sources>
  
  <validation_check>
    BEFORE finalizing bullets for Position N:
      FOR EACH skill/tool mentioned in bullets:
        VERIFY: skill appears in position[N] sections
        IF skill only in master_skills_inventory:
          FLAG as "No position evidence for '[skill]' in Position [N]"
          REMOVE or ask user to confirm experience in this role
  </validation_check>
</master_skills_quarantine_guardrail>
```

---

## 17. Scope Attribution Validation

> **Implementation Target:** Add to [job-history-v2-creation.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/job-history-v2-creation.md).

### Specific Guardrail: The "Individual vs. Team" Boundary
Prevents claiming team/organizational achievements as individual accomplishments.

**Instruction Text:**
```xml
<scope_attribution_guardrail>
  <priority>HIGH</priority>
  <instruction>
    Verify that claimed achievements match the user's actual scope of control.
  </instruction>
  
  <attribution_rules>
    <rule id="team_achievement_markers">
      IF bullet uses "Led", "Managed", "Coordinated", "Oversaw":
        VALID: Individual can claim this if they have leadership scope
        CHECK: Does position have team_scope.direct_reports > 0 OR team_scope.team_size > 0?
        IF NO team scope: FLAG as "Leadership claim without team scope evidence"
    </rule>
    
    <rule id="organizational_results">
      IF bullet claims company-wide metrics (e.g., "Increased company revenue by $5M"):
        VERIFY: User's role level justifies this claim
        IF role = Individual Contributor AND impact = company-wide:
          FLAG as "Overstated scope - change to 'Contributed to' or specify personal portion"
    </rule>
    
    <rule id="collaborative_work">
      IF job_history shows "honest_limitations" about limited autonomy:
        ENSURE bullets use collaborative language ("Contributed to", "Supported", "Assisted in")
        NOT ownership language ("Built", "Launched", "Delivered")
    </rule>
  </attribution_rules>
</scope_attribution_guardrail>
```

---

## 18. Cross-Phase Job History Consistency

> **Implementation Target:** Add to [workflow-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-3/workflow-router.md) (primary) and [entry-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/entry-router.md) (secondary).

### Specific Guardrail: The "No History Drift" Validator
Ensures job history doesn't change between phases without user input.

**Instruction Text:**
```xml
<cross_phase_consistency_guardrail>
  <priority>CRITICAL</priority>
  <instruction>
    Job history generated in Phase 1 is immutable unless user explicitly updates it.
  </instruction>
  
  <phase_transition_validation>
    <phase_1_to_phase_2>
      WHEN: User requests bullet optimization (Phase 2)
      CHECK: Reference job history, do NOT modify it
      RULE: If bullet mentions skills not in job history, ask user to confirm before adding
    </phase_1_to_phase_2>
    
    <phase_1_to_phase_3>
      WHEN: User requests JD comparison (Phase 3)
      CHECK: Pull job history as-is for evidence matching
      RULE: Do NOT add new positions or skills to job history during Phase 3
      EXCEPTION: User explicitly says "I also have experience with X" - then offer to update
    </phase_1_to_phase_3>
  </phase_transition_validation>
  
  <drift_detection>
    IF Phase 3 bullets mention skills not in Phase 1 job history:
      STOP and ask: "I don't see [skill] in your job history. Should I add it to [Position N]?"
      WAIT for user confirmation before proceeding
  </drift_detection>
</cross_phase_consistency_guardrail>
```

---

## 19. Fit Assessment Score Consistency

> **Implementation Target:** Add to [fit-thresholds.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/fit-thresholds.md).

### Specific Guardrail: The "Score Justification" Requirement
Ensures fit percentages match the described gaps.

**Instruction Text:**
```xml
<fit_score_consistency_guardrail>
  <priority>MODERATE</priority>
  <instruction>
    Fit assessment score must be mathematically consistent with identified gaps.
  </instruction>
  
  <consistency_check>
    AFTER calculating preliminary fit score:
      1. Count total JD requirements (N_total)
      2. Count matched requirements (N_matched)
      3. Calculate: expected_score = (N_matched / N_total) * 100
      4. Compare to stated fit score
      
      IF |expected_score - stated_score| > 10%:
        FLAG as "Score-gap mismatch"
        RECALCULATE using proper weighting (Required: 1.5x, Preferred: 1.0x)
  </consistency_check>
  
  <score_to_action_validation>
    IF fit_score >= 90% BUT gaps section shows 3+ critical missing requirements:
      FLAG as "Score too high for number of critical gaps"
      
    IF fit_score < 75% BUT gaps section shows only 1-2 minor missing skills:
      FLAG as "Score too low for minor gaps"
  </score_to_action_validation>
</fit_score_consistency_guardrail>
```

---

## 20. Acronym Expansion Enforcement

> **Implementation Target:** Add to [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) within `<critical_formatting_rules>` section (separate from the existing `<quality_assurance_rules>` section at lines 11-50).

### Specific Guardrail: The "First-Use Spell-Out" Rule
Enforces that acronyms are spelled out on first use, especially for non-standard terms.

**Instruction Text:**
```xml
<acronym_expansion_guardrail>
  <priority>MODERATE</priority>
  <instruction>
    Industry-standard acronyms (AWS, SQL, API) can be used as-is.
    Domain-specific or ambiguous acronyms must be spelled out on first use.
  </instruction>
  
  <standard_acronyms_allowed>
    AWS, SQL, API, REST, JSON, XML, HTML, CSS, CI/CD, DevOps, SaaS, PaaS,
    ATS, KPI, ROI, SLA, ETL, GDPR, HIPAA, SOC, NIST
  </standard_acronyms_allowed>
  
  <expansion_required>
    FOR acronyms NOT in standard list:
      - First mention: "Federal Information Security Management Act (FISMA)"
      - Subsequent: "FISMA"
      
    EXCEPTION: If acronym appears in JD without expansion, match JD format
  </expansion_required>
  
  <validation>
    SCAN all bullets for uppercase 2-5 letter sequences
    IF sequence NOT in standard_acronyms_allowed:
      IF first occurrence in resume:
        FLAG: "Acronym '[ABC]' should be spelled out on first use"
  </validation>
</acronym_expansion_guardrail>
```

---

## 21. Limitation-to-Bullet Cross-Check

> **Implementation Target:** Add to [evidence-matching.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-2/evidence-matching.md) (primary) and [incremental-updates.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-3/incremental-updates.md) (secondary).

### Specific Guardrail: The "Don't Contradict Yourself" Validator
Ensures bullets don't recommend skills for positions where user stated limitations.

**Instruction Text:**
```xml
<limitation_bullet_cross_check_guardrail>
  <priority>CRITICAL</priority>
  <instruction>
    During Phase 3 bullet generation, check honest_limitations BEFORE recommending bullets for each position.
  </instruction>
  
  <validation_logic>
    WHEN generating bullets for Position N in Phase 3:
      1. Load position[N].honest_limitations
      2. Extract JD requirements
      3. FOR EACH JD requirement:
           IF requirement mentions skill/tool in honest_limitations:
             DO NOT generate bullet for Position N using this requirement
             ADD to gap analysis: "Position [N] limited: [limitation text]"
  </validation_logic>
  
  <example_scenario>
    JD requires: "Python, AWS, Docker"
    Position 2 honest_limitations: "Limited Python exposure (used only for scripts)"
    
    CORRECT behavior:
      - Generate bullets for Positions 1, 3, 4 using Python if evidenced
      - SKIP Python bullets for Position 2
      - OR use hedged language: "Supported Python script development"
      
    INCORRECT behavior:
      - Generate "Built Python applications" for Position 2 (contradicts limitation)
  </example_scenario>
</limitation_bullet_cross_check_guardrail>
```

---

## Summary of Fourth-Pass Additions

These 7 additional guardrails address **overlooked enforcement gaps**:

1. **Phrase Repetition Enforcement (#15)**: Automated scanner for 3+ word sequences appearing >2 times
2. **Master Skills Quarantine (#16)**: Prevents generic skill inventory from contaminating position-specific bullets
3. **Scope Attribution (#17)**: Validates individual vs. team/org achievement claims
4. **Cross-Phase Consistency (#18)**: Prevents job history drift between Phase 1→2→3
5. **Fit Score Consistency (#19)**: Ensures percentage scores match identified gaps
6. **Acronym Expansion (#20)**: Enforces spell-out rules for non-standard acronyms
7. **Limitation-to-Bullet Cross-Check (#21)**: Prevents generating bullets that contradict stated limitations

**Key Insight**: These guardrails focus on **consistency enforcement across time** (cross-phase), **attribution accuracy** (team vs. individual), and **automated detection** for rules that were stated but not enforced.

# Part 5: Additional Guardrail Suggestions (Fifth Pass)

This pass focuses on **output format enforcement**, **user state management**, and **conversation flow consistency**.

## 22. Em-Dash Character Validation

> **Implementation Target:** Add to [format-rules.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/format-rules.md) within **EXISTING** `<quality_assurance_rules>` section (lines 11-50) as automated enforcement for the existing `no_em_dashes` rule in `<critical_formatting_rules>`. **Do not create a new section.**

### Specific Guardrail: The "No Em-Dash" Scanner
The rule exists but has no automated enforcement mechanism.

**Instruction Text:**
```xml
<em_dash_validation_guardrail>
  <priority>HIGH</priority>
  <instruction>
    Scan ALL output text for em-dash characters (—) before presenting to user.
  </instruction>
  
  <detection_and_correction>
    SCAN final output for Unicode character U+2014 (—)
    
    IF em-dash found:
      FOR EACH occurrence:
        REPLACE with hyphen (-) OR rephrase sentence
        
    COMMON PATTERNS TO FIX:
      - "experience — including" → "experience, including" OR "experience - including"
      - "skills—Python" → "skills: Python" OR "skills - Python"
      - "2020—2023" → "2020-2023"
  </detection_and_correction>
  
  <also_check>
    - En-dash (–) U+2013: Replace with hyphen for ranges
    - Curly quotes (" ") U+201C/U+201D: Replace with straight quotes
    - Curly apostrophe (') U+2019: Replace with straight apostrophe
  </also_check>
</em_dash_validation_guardrail>
```

---

## 23. User State Persistence Validation

> **Implementation Target:** Add to [workflow-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-3/workflow-router.md) (primary) and [entry-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/entry-router.md) (secondary). Add state tracking to the Context State Schema section.

### Specific Guardrail: The "Remember User Context" Check
Ensures location preferences and other user-stated constraints are consistently applied.

**Instruction Text:**
```xml
<user_state_persistence_guardrail>
  <priority>CRITICAL</priority>
  <instruction>
    User-stated preferences (location, remote preference, target roles) must be retained and applied across all phases.
  </instruction>
  
  <state_to_track>
    - user.location_preference: "Remote only", "Hybrid OK", "On-site OK"
    - user.current_location: State/City
    - user.target_role_level: "IC", "Lead", "Manager", "Director"
    - user.industry_focus: List of preferred industries
    - user.years_of_experience: Calculated from job history
  </state_to_track>
  
  <validation_at_each_phase>
    PHASE 1: Extract and store user state from resume/conversation
    PHASE 2: Reference user state when suggesting bullet alternatives
    PHASE 3: Apply user state to JD fit assessment (location blocking, role level match)
    
    IF user state is unknown AND required for decision:
      ASK before proceeding: "Are you open to on-site roles, or seeking remote only?"
  </validation_at_each_phase>
  
  <consistency_check>
    IF Phase 3 recommends role that conflicts with Phase 1 user state:
      FLAG as "Recommendation conflicts with user preferences"
      DO NOT proceed without acknowledgment
  </consistency_check>
</user_state_persistence_guardrail>
```

---

## 24. Alternatives Presentation Consistency (Enhanced)

> **Implementation Target:** Add to [evidence-matching.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-2/evidence-matching.md) (primary) and [verb-categories.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/core/verb-categories.md) (secondary). This replaces simple alternative generation with context-aware filtering.

### Specific Guardrail: Context-Aware Alternative Filtering
Ensures alternatives adhere to verb diversity rules and avoid recommending saturated categories.

**Instruction Text:**
```xml
<alternatives_presentation_guardrail>
  <priority>HIGH</priority>
  <instruction>
    When optimizing bullets, present at least 2 alternatives that respect existing verb category usage.
  </instruction>
  
  <step_1_build_category_inventory>
    BEFORE generating alternatives, calculate:
      - global_category_counts = {Built: N, Lead: N, Managed: N, Improved: N, Collaborate: N}
      - position_category_usage = {Position1: [categories used], Position2: [...], ...}
      - saturation_threshold = (total_bullets / 5) + 1  <!-- Approx 27% per category -->
  </step_1_build_category_inventory>
  
  <step_2_identify_unavailable_categories>
    unavailable_categories = []
    
    FOR EACH category in global_category_counts:
      IF count >= saturation_threshold:
        ADD to unavailable_categories
        REASON: "Approaching 40% skew threshold"
        
    FOR current_position:
      FOR EACH category already used in this position:
        ADD to unavailable_categories (for THIS position only)
        REASON: "Already used in this position"
  </step_2_identify_unavailable_categories>
  
  <step_3_generate_from_available_pool>
    available_categories = ALL_CATEGORIES - unavailable_categories
    
    <!-- LOOP PREVENTION: Escape hatch when all saturated -->
    IF available_categories.length == 0:
      WARN: "All categories at saturation - using least-used category"
      available_categories = [category with lowest global count]
      
    PRIMARY: Best natural fit from available_categories
    ALTERNATIVE 1: Next best fit from available_categories
    ALTERNATIVE 2 (optional): Third option OR different focus (outcome vs action)
  </step_3_generate_from_available_pool>
  
  <validation>
    IF output contains only 1 bullet version per input:
      FLAG as "Missing alternative angles" and REGENERATE
  </validation>
</alternatives_presentation_guardrail>
```

### Sub-Guardrails for #24

```xml
<alternatives_sub_guardrails>
  
  <sub_guardrail id="24A" name="underused_category_promotion">
    <priority>MODERATE</priority>
    <instruction>
      If any category has 0 uses across all bullets and we're generating Alternative 2,
      force-include an option using the underused category.
    </instruction>
    <loop_risk>LOW - additive only, does not block other options</loop_risk>
  </sub_guardrail>
  
  <sub_guardrail id="24B" name="same_position_history_check">
    <priority>HIGH</priority>
    <instruction>
      Before suggesting a category for Position N, verify Position N doesn't already
      have an accepted bullet using that category.
    </instruction>
    <loop_risk>LOW - read-only check, no writes until user accepts</loop_risk>
  </sub_guardrail>
  
  <sub_guardrail id="24C" name="jd_alignment_tiebreaker">
    <priority>MODERATE</priority>
    <instruction>
      When 2+ categories are equally "available", prefer the one that matches JD keywords.
      Example: JD mentions "led" 5 times → prefer Lead category over Managed.
    </instruction>
    <loop_risk>NONE - selection logic only, no state changes</loop_risk>
  </sub_guardrail>
  
  <sub_guardrail id="24D" name="saturation_warning_message">
    <priority>LOW</priority>
    <instruction>
      When a category is deprioritized due to saturation, include informational note:
      "Note: 'Built' verbs have been used 4 times; consider 'Led' or 'Improved' for variety."
    </instruction>
    <loop_risk>NONE - informational only, no logic changes</loop_risk>
  </sub_guardrail>
  
</alternatives_sub_guardrails>
```

### Loop Prevention Principles for #24

```xml
<loop_prevention_principles>
  <principle id="soft_limits">
    Use SOFT constraints (deprioritize) not HARD blocks for global category counts.
    Position-level: Hard constraint (never repeat within position)
    Global-level: Soft constraint (deprioritize, don't block entirely)
  </principle>
  
  <principle id="escape_hatch">
    If ALL categories are "unavailable", fall back to least-used category.
    Never return "no valid alternatives" error.
  </principle>
  
  <principle id="one_way_data_flow">
    Alternatives guardrail READS verb inventory but does NOT WRITE to it.
    Writing only occurs when user ACCEPTS a recommendation.
  </principle>
  
  <principle id="no_premature_counting">
    Do NOT count alternatives as "used" before user selection.
    Only accepted bullets update the category inventory.
  </principle>
</loop_prevention_principles>
```

### Anti-Patterns to Avoid

| Anti-Pattern | Why It Causes Loops |
|--------------|---------------------|
| Hard blocking categories after N uses | Could result in "no valid alternatives" error |
| Auto-regeneration when alternatives don't meet diversity | Creates feedback loop with quality gate |
| Counting alternatives before user accepts | Depletes inventory before selections made |

---

## 25. User Confirmation Tracking

> **Implementation Target:** Add to [workflow-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-3/workflow-router.md) (primary) and [entry-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/entry-router.md) (secondary). Add tracking state to the Context State Schema.

### Specific Guardrail: The "Don't Ask Twice" Memory
Prevents repeatedly asking user the same clarifying question.

**Instruction Text:**
```xml
<confirmation_tracking_guardrail>
  <priority>MODERATE</priority>
  <instruction>
    Track user confirmations within session to avoid redundant questions.
  </instruction>
  
  <tracking_logic>
    MAINTAIN list: confirmed_skills = []
    
    WHEN user confirms experience:
      ADD to confirmed_skills: {skill: "Python", position: "all", confirmed_at: timestamp}
      
    BEFORE asking "Do you have experience with [X]?":
      CHECK: Is [X] in confirmed_skills?
      IF YES: Skip question, use confirmed experience
      IF NO: Ask user
  </tracking_logic>
  
  <session_scope>
    confirmed_skills persists within conversation session
    RESET on: new conversation, explicit "start fresh" command
  </session_scope>
  
  <anti_pattern_detection>
    IF same question asked 2+ times in session:
      FLAG as "Duplicate clarification request"
      CHECK confirmation_tracking for existing answer
  </anti_pattern_detection>
</confirmation_tracking_guardrail>
```

---

## 26. Output Structure Consistency

> **Implementation Target:** Add to [LLM_GENERATION_INSTRUCTIONS.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/templates/LLM_GENERATION_INSTRUCTIONS.md). Add phase-specific output templates as new sections.

### Specific Guardrail: The "Template Adherence" Validator
Ensures all outputs follow expected structure patterns.

**Instruction Text:**
```xml
<output_structure_consistency_guardrail>
  <priority>HIGH</priority>
  <instruction>
    All phase outputs must follow their defined structure templates.
  </instruction>
  
  <phase_3_bullet_output_template>
    REQUIRED SECTIONS (in order):
      1. JD Summary (company, role, key requirements)
      2. Fit Assessment (score, match breakdown)
      3. Gap Analysis (if score < 90%)
      4. Professional Summary (customized for JD)
      5. Position Bullets (reverse chronological)
      6. Keyword Coverage Report (if keywords provided)
      7. Metadata (character counts, verb distribution)
      8. Grammar Check Reminder
      
    IF any section missing:
      FLAG as "Incomplete output structure"
      ADD missing section before presenting
  </phase_3_bullet_output_template>
  
  <plain_text_export_template>
    REQUIRED ELEMENTS:
      - Professional Summary (no markdown)
      - Positions with headers (Title | Company | Dates)
      - Bullets with • character
      - Metadata block at bottom
      
    FORBIDDEN ELEMENTS:
      - Markdown formatting (**, _, #)
      - Code blocks
      - Escaped characters (\~)
  </plain_text_export_template>
</output_structure_consistency_guardrail>
```

---

## 27. Graceful Input Type Detection

> **Implementation Target:** Add to [workflow-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-3/workflow-router.md) (primary) and [entry-router.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/phases/phase-1/entry-router.md) (secondary). Enhance the JD Validation Heuristics section.

### Specific Guardrail: The "What Did You Give Me?" Validator
Improves handling of ambiguous user inputs.

**Instruction Text:**
```xml
<input_type_detection_guardrail>
  <priority>HIGH</priority>
  <instruction>
    Before processing user input, classify input type with confidence score.
  </instruction>
  
  <classification_rules>
    <type id="resume">
      INDICATORS: Multiple positions, dates, bullet points, education section
      CONFIDENCE: HIGH if 3+ positions detected
    </type>
    
    <type id="job_description">
      INDICATORS: "About the role", "Requirements", "Qualifications", company name + job title
      CONFIDENCE: HIGH if requirements section detected
    </type>
    
    <type id="bullet_points">
      INDICATORS: 1-5 isolated bullet points, no position context
      CONFIDENCE: HIGH if starts with action verb, no date range
    </type>
    
    <type id="keyword_list">
      INDICATORS: Comma-separated skills, no sentences
      CONFIDENCE: HIGH if >5 items, mostly single words/short phrases
    </type>
  </classification_rules>
  
  <ambiguity_handling>
    IF confidence < 80% for all types:
      ASK: "I received your input but want to confirm - is this a [most likely type] or something else?"
      WAIT for confirmation before proceeding
      
    IF input contains BOTH JD and keywords:
      PARSE separately, apply keyword_input_handling rules
  </ambiguity_handling>
</input_type_detection_guardrail>
```

---

## Summary of Fifth-Pass Additions

These 6 additional guardrails address **user experience consistency**:

1. **Em-Dash Validation (#22)**: Automated scanner for forbidden Unicode characters
2. **User State Persistence (#23)**: Location/role preferences tracked across phases
3. **Alternatives Presentation (#24)**: Ensures bullet optimization offers multiple angles
4. **Confirmation Tracking (#25)**: Prevents asking same clarifying question twice
5. **Output Structure Consistency (#26)**: Template adherence for all phase outputs
6. **Input Type Detection (#27)**: Confidence-based classification of user inputs

**Key Insight**: These guardrails focus on **conversation quality** and **format consistency** - ensuring the system behaves predictably and respects user context throughout the session.

---

# Guardrail Summary (All Passes)

| Pass | Focus Area | Guardrails Added |
|------|-----------|------------------|
| 1 | Data Integrity | #1-4: Metric traceability, chronological order, summary abstraction, metric compatibility |
| 2 | Data Safety | #5-7: Limitation enforcement, data loss prevention, skill classification |
| 3 | Quantitative Enforcement | #8-14: Character limits, verb diversity, keyword density, plausibility, recency, reconciliation, failure handling |
| 4 | Cross-Phase Consistency | #15-21: Phrase repetition, master skills quarantine, scope attribution, phase consistency, fit scores, acronyms, limitations |
| 5 | User Experience | #22-27: Em-dash validation, user state, alternatives, confirmation tracking, output structure, input detection |

**Total: 27 Guardrails**

---

> [!NOTE]
> **Condensation Rule:** A high-level implementation of ALL 27 guardrails should also be added to:
> - [PROJECT-INSTRUCTIONS.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/PROJECT-INSTRUCTIONS.md) within `<quality_assurance_rules>` section (lines 997-1320)
> - [quick-start-phase.md](file:///Users/mkaplan/Documents/GitHub/optimize-my-resume/quick-start-phase.md) within `<quality_assurance_rules>` section (lines 373-507)
> 
> Both files also share `<position_ordering>` sections that should include Guardrail #2 (Chronological Integrity):
> - PROJECT-INSTRUCTIONS.md lines 1363-1366
> - quick-start-phase.md lines 550-553



