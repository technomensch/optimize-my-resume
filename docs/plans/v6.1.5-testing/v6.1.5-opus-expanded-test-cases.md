# v6.1.5 - Opus-Expanded Test Cases (Phases 2-4)

**Author:** Claude Opus 4.5
**Date:** 2025-12-30
**Purpose:** Supplement Sonnet's 32 baseline test cases with 35+ additional high-complexity scenarios

This file contains advanced test cases targeting edge cases, error recovery, blocking gate combinations, and cross-phase integration scenarios that Sonnet's baseline tests don't cover.

---

## Test Case Numbering Convention

| Prefix | Category | Description |
|--------|----------|-------------|
| INTX | Integration Extended | Complex Phase 1 → Phase 3 flows |
| INCX | Incremental Extended | Advanced add/edit/remove edge cases |
| DIFFX | Diff Extended | Complex re-comparison scenarios |
| SUMX | Summary Extended | Advanced summary generation |
| GATE | Blocking Gate Combinations | Multiple gate interactions |
| ERR | Error Recovery | Failure handling and recovery |

---

## PART 14: Extended Integration Flow Tests (INTX)

These tests cover complex integration scenarios not addressed in Sonnet's INT series.

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| INTX-001 | Contractor Citation Format | History: "Accenture (Client: DHS)" | Citation: "Accenture (Client: DHS) \| Business Analyst" | Check: Client relationship preserved in citation |
| INTX-002 | Freelance Multi-Client | History: 5 freelance clients, same period | Citation: "Freelance (5 clients) \| Consultant (2019-2022)" | Check: Client count aggregated, not listed individually |
| INTX-003 | Internship vs Full-Time Weighting | JD requires "5+ years experience", history has 3 FT + 2 intern | System calculates 3 years (interns weighted 0.5x or excluded) | Check: Internship disclaimer in experience calculation |
| INTX-004 | Evidence from Certification Only | JD: "AWS required", History: No AWS work but has AWS cert | Status: MATCHED via certification, confidence 0.9 | Check: Citation references certification, not job experience |
| INTX-005 | Stale Skills (>5 years old) | JD: "Python", History: Python used only 2015-2017 | Status: PARTIAL (stale), recommendation to highlight recent use | Check: Recency warning displayed with skill match |
| INTX-006 | Implicit Skill from Tool | JD: "SQL", History: "Used Tableau for reporting" | Status: INFERRED (Tableau implies SQL), confidence 0.6 | Check: Inference reasoning displayed in gap rationale |
| INTX-007 | Skill Level Mismatch | JD: "Expert Python", History: "Python (intermediate)" | Status: PARTIAL, gap rationale explains level deficit | Check: Proficiency level noted in evidence |
| INTX-008 | Cross-Position Skill Aggregation | JD: "5+ years Python", History: 2 yrs @ Co A + 3 yrs @ Co B | Status: MATCHED, citations show both positions | Check: Combined duration >= requirement threshold |

---

## PART 15: Extended Incremental Update Tests (INCX)

Advanced edge cases for position manipulation not in Sonnet's INC series.

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| INCX-001 | Batch Add (3 positions at once) | User provides 3 positions in single message | All 3 added, sorted chronologically, single confirmation | Check: All positions indexed correctly in one operation |
| INCX-002 | Edit Causes Skill Reclassification | Edit: Change "Managed projects" → "Managed Scrum sprints" | Skills array updated: +Scrum (hard), recategorization runs | Check: Skills arrays reflect new keywords |
| INCX-003 | Edit Position Title to Match JD | Edit: "PM" → "Product Manager" (matches JD exactly) | Re-comparison would show improved keyword match | Check: Title change updates evidence citations |
| INCX-004 | Remove Position Referenced in Cache | Position 2 cited in cached JD comparison | Warning: "This position is referenced in 2 cached comparisons" | Check: User informed of downstream impact |
| INCX-005 | Add Position with Only Soft Skills | Position has: Leadership, Communication, Teamwork | hard_skills_demonstrated: [], soft_skills_demonstrated: [3 items] | Check: Empty hard skills array doesn't cause errors |
| INCX-006 | Merge Duplicate Companies | 2 positions at "Google Inc" and "Google LLC" | System suggests merge: "Same company? Combine?" | Check: Company name normalization offered |
| INCX-007 | Split One Position into Two | User: "Actually that was two roles at same company" | System creates 2 position entries, divides achievements | Check: Original achievements distributed, no duplication |
| INCX-008 | Add Position with Gap Before | Add 2020-2022 role, gap exists 2018-2020 | Gap noted in metadata but no penalty | Check: Employment gap flagged for user awareness only |
| INCX-009 | Edit End Date to Future | User: "Change end date to 2026-06" | Rejects with "End date cannot be in the future" | Check: Validation triggers on edit, not just add |
| INCX-010 | Undo Last Edit | User: "Undo that change" immediately after edit | Previous version restored from checkpoint | Check: Checkpoint system maintains last-known-good state |

---

## PART 16: Extended Diff Tests (DIFFX)

Complex re-comparison scenarios beyond Sonnet's DIFF series.

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| DIFFX-001 | Score Decrease (Regression) | Remove Python from history, re-run JD | Score drops (e.g., 81% → 68%), "Regressions" section shows Python | Check: Regression clearly labeled with previous status |
| DIFFX-002 | Multiple JDs Re-Compared | User: "Re-run comparisons for all saved JDs" | Batch re-comparison, summary table of score deltas | Check: Each JD shows individual delta and aggregate trend |
| DIFFX-003 | JD Updated Since Last Comparison | JD in cache differs from pasted JD (employer updated posting) | Warning: "JD appears modified. Re-parse?" | Check: Hash/checksum comparison detects changes |
| DIFFX-004 | Mixed Improvements/Regressions | Add Python (+), Remove SQL (-) | Improvements: Python, Regressions: SQL, Net: 0 delta | Check: Both sections populated correctly |
| DIFFX-005 | Status Change Within Same Category | PARTIAL (0.5) → PARTIAL (0.75) improvement | Shows as improvement with confidence delta | Check: Intra-status improvements tracked |
| DIFFX-006 | Re-Comparison After Schema Upgrade | v1.0 → v2.0 upgrade, then re-compare | System notes new fields available (hard/soft separation) | Check: "Enhanced analysis available" message |
| DIFFX-007 | Stale Cache Warning | Cache is 30+ days old | Warning: "Cached JD is 45 days old. Employer may have updated." | Check: Age threshold triggers staleness warning |

---

## PART 17: Extended Summary Tests (SUMX)

Advanced summary generation scenarios beyond Sonnet's SUM series.

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| SUMX-001 | Executive-Level Summary | History: VP/C-level roles only | Summary emphasizes strategic impact, P&L, board exposure | Check: Seniority-appropriate language used |
| SUMX-002 | Entry-Level Summary | History: 1-2 years, junior roles | Summary emphasizes growth potential, education, skills | Check: No overclaiming of experience |
| SUMX-003 | Per-JD Summary Skill Substitution Limit | JD has 8 required skills, summary can fit 3 | Top 3 by priority inserted, others omitted | Check: Highest-priority skills selected |
| SUMX-004 | Summary with Conflicting Metrics | History: "Saved $2M" and "Reduced costs by $500K" at same company | Aggregates conservatively or uses larger figure with context | Check: No double-counting of metrics |
| SUMX-005 | Industry Pivot Summary | History: Healthcare → Tech transition | Summary bridges domains: "Healthcare tech expertise transitioning to SaaS" | Check: Transition narrative present |
| SUMX-006 | Remote Work Emphasis | JD: "Remote position", History: 3 years remote | Summary includes "experienced remote collaborator" language | Check: Remote compatibility highlighted when relevant |
| SUMX-007 | Summary Keyword Density Check | Per-JD summary generated | At least 2 JD keywords appear in first 100 characters | Check: Keyword density meets ATS optimization |
| SUMX-008 | No Recognizable Companies | History: All small/unknown companies | Summary omits company name-dropping, focuses on achievements | Check: No awkward "at CompanyX you've never heard of" phrasing |

---

## PART 18: Blocking Gate Combination Tests (GATE)

Tests for scenarios where multiple blocking gates interact.

| Test ID | Scenario | Gates Triggered | Expected Behavior | Validation Rule |
|---------|----------|-----------------|-------------------|-----------------|
| GATE-001 | Hard Skill + Location Gate | Missing 4/6 hard skills AND location mismatch | Both warnings displayed, most severe first | Check: Location gate shown before skills gate |
| GATE-002 | Low Score + Hard Skill Deficit | Score = 28% AND missing 5/7 hard skills | Single combined warning (not two separate) | Check: Warnings consolidated, not duplicated |
| GATE-003 | Gate Override Persistence | User overrides Gate 1, hits Gate 2 | Gate 2 still fires (override is per-gate) | Check: Override doesn't bypass subsequent gates |
| GATE-004 | All Gates Pass (Edge Case) | Score = 50, skills balanced, location match | No gates triggered, proceeds to recommendations | Check: Smooth flow when all gates pass |
| GATE-005 | Location Gate with Remote Exception | JD: "NYC only" but user in NJ | Warning but note: "You may be within commuting distance" | Check: Proximity detection for non-exact matches |
| GATE-006 | Gate Skip for Returning User | User previously overrode all gates for this JD | System remembers preference, skips gates on re-comparison | Check: Override state persisted in JD cache |
| GATE-007 | Borderline Score (29 vs 30 threshold) | Score = 29.5, rounds to 30 | Gate does NOT trigger (30 is threshold) | Check: Rounding favors user at boundary |

---

## PART 19: Error Recovery Tests (ERR)

Tests for system resilience and error handling.

| Test ID | Scenario | Error Condition | Expected Recovery | Validation Rule |
|---------|----------|-----------------|-------------------|-----------------|
| ERR-001 | Corrupted Job History JSON | Invalid JSON in v2.0 file | Error: "Job history file corrupted. Restore backup?" | Check: Backup offered, not silent failure |
| ERR-002 | Missing Schema Version | v2.0 file missing `schema_version` field | System infers version from structure, warns user | Check: Graceful degradation with warning |
| ERR-003 | Position with Null Required Field | Position missing `job_title` (required) | System prompts: "Position 3 is missing job title. Enter now?" | Check: Repair prompt before proceeding |
| ERR-004 | Circular Skill Reference | Skill A implies B, B implies A (edge case) | System detects loop, breaks at first occurrence | Check: No infinite loop in inference |
| ERR-005 | JD Parse Timeout | JD parsing exceeds 30 seconds | Partial result returned with warning, retry offered | Check: Timeout doesn't crash, partial data preserved |
| ERR-006 | Duplicate Position Detection | Two positions with identical company/title/dates | Warning: "Duplicate position detected. Remove one?" | Check: Duplicate flagged, user decides |
| ERR-007 | Cache Read Failure | `jd_parsed/` directory permissions issue | Error with specific remedy: "Check folder permissions" | Check: Actionable error message provided |

---

## PART 20: Sonnet Logic Corrections & Missing Gaps (FIX)

These tests address logic issues and gaps identified in Sonnet's original test cases.

### Logic Issues Found in Sonnet's Tests

| Sonnet Test | Issue | Correction |
|-------------|-------|------------|
| INC-004 | Says indices "shifted up" | Should be "shifted DOWN" (5→4, 6→5, etc.) |
| SUM-005 | Uses score 42 as threshold | Blocking gate is at 30; 42 would NOT trigger gate |
| INT-007 | No weight ratios specified | Must define: Required = 1.5x weight of Preferred |
| INT-006 | Confidence "> 0.5" ambiguous | Boundary: exactly 0.5 should be handled |

### Additional Gap-Filling Tests

| Test ID | Scenario | Input | Expected Behavior | Validation Rule |
|---------|----------|-------|-------------------|-----------------|
| FIX-001 | Skill Case Sensitivity | JD: "Python", History: "PYTHON" | Status: MATCHED (case-insensitive) | Check: Matching ignores case |
| FIX-002 | Duplicate Skill Within Position | Position has ["Python", "python", "SQL"] | Deduplicates to ["Python", "SQL"] | Check: No duplicate entries in arrays |
| FIX-003 | JD with Only Preferred Skills | JD has skills_wanted but empty skills_needed | System proceeds without hard-skill gate | Check: Gate logic handles missing required section |
| FIX-004 | Inverted Date Range | Position: start=2023-01, end=2020-01 | Error: "End date cannot be before start date" | Check: Date order validated |
| FIX-005 | Confidence Boundary (0.5) | Inference confidence = exactly 0.50 | Status: INFERRED (0.5 is inclusive threshold) | Check: Boundary handled consistently |
| FIX-006 | Score Boundary (30) | Match score = exactly 30 | Gate does NOT trigger (>= 30 is passing) | Check: Boundary condition correct |
| FIX-007 | Two Simultaneous Full-Time Jobs | 2 W-2 positions with identical date ranges | Warning: "Overlapping full-time roles detected" | Check: Moonlighting flagged for review |
| FIX-008 | Required vs Preferred Weight Ratio | JD: 2 Required MISSING, 4 Preferred MATCHED | Score formula: Required = 1.5x weight in calculation | Check: Score reflects weighted priorities |
| FIX-009 | Empty skills_needed Array | JD parses with skills_needed: [] | Hard skill gate skipped, soft skills evaluated | Check: Empty array doesn't crash gate logic |
| FIX-010 | Position Index After Removal | Remove Position 3 of 5 | Positions 4,5 become 3,4 (shift DOWN not up) | Check: Indices decrement correctly |
| FIX-011 | Summary Low Experience | History: 1 year total experience | Summary says "1 year" not "years across companies" | Check: Grammar/phrasing adjusts to experience level |
| FIX-012 | Fuzzy Company Match in Citation | History: "Google LLC", JD match from "Alphabet/Google" | Citation normalizes to standard name | Check: Related company names recognized |

---

## Summary

### New Test Cases Added by Opus: 47

| Category | Count | Focus Area |
|----------|-------|------------|
| INTX | 8 | Complex integration (contractors, freelance, stale skills) |
| INCX | 10 | Advanced position manipulation (batch, merge, undo) |
| DIFFX | 7 | Complex diff scenarios (batch, regression, stale cache) |
| SUMX | 8 | Advanced summary (executive, entry-level, pivots) |
| GATE | 7 | Blocking gate combinations and edge cases |
| ERR | 7 | Error recovery and system resilience |
| FIX | 12 | Sonnet logic corrections and gap-filling |

### Combined with Sonnet's 32 Baseline Tests: 79 Total (Phases 2-4)

### Key Testing Themes

1. **Citation Format Consistency** - Contractor, freelance, multi-role scenarios all follow `Company | Title` format
2. **Skill Temporal Relevance** - Skills used >5 years ago flagged as potentially stale
3. **Gate Combination Logic** - Multiple gates interact predictably without duplication
4. **Graceful Degradation** - Errors provide recovery paths, not crashes
5. **Cross-Phase State Consistency** - Edits to history propagate correctly to cached comparisons

---

## Integration with Existing Test Suite

These 47 tests should be added to the v6.0 test suite after validation. They complement:

- **v6.0-deep-dive-test-cases.md** (95+ Phase 1 tests)
- **v6.1.5-sonnet-test-cases.md** (32 Phase 2-4 baseline tests)

**Total Coverage After Merge:** 174+ test cases

---

## Execution Priority

| Priority | Tests | Rationale |
|----------|-------|-----------|
| P0 (Critical) | GATE-*, ERR-001 to ERR-003, FIX-004 to FIX-010 | Blocking gates, data integrity, boundary conditions |
| P1 (High) | INTX-001 to INTX-004, DIFFX-001, FIX-001 to FIX-003 | Core workflow reliability |
| P2 (Medium) | INCX-*, SUMX-*, FIX-011, FIX-012 | Feature completeness |
| P3 (Low) | Remaining | Edge case coverage |
