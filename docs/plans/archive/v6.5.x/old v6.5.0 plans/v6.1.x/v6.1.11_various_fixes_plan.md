# Patch Plan: v6.1.11 - Quality Gate, Auto-Export & Keyword Evidence

**Version:** 6.1.11
**Branch:** v6.1.11-various_fixes
**Type:** Improvement/Enhancement
**Created:** 2025-12-31
**Status:** Complete

---

## Executive Summary

This patch addresses critical gaps in the output quality enforcement system and keyword handling:

1. **Missing Auto-Regeneration Loop:** While quality checks exist, there's no instruction to regenerate bullets when issues are found
2. **Missing Auto-Export:** No automatic plain text export after quality validation passes
3. **Missing Keyword Evidence Principle:** No safeguard preventing keyword stuffing without backing evidence (v6.1.11 addition)
4. **Missing Keyword Input Handling:** No workflow for handling keywords provided with JD or after bullet generation (v6.1.11 addition)

These gaps allow quality issues to slip through, create manual copy-paste work, and risk inauthentic keyword usage.

---

## Problem Analysis

### Fix #1: Missing Automatic Quality Gate with Regeneration

**Current State:**
- `pre_output_quality_checklist` exists with automated scan patterns (lines 632-646 in PROJECT-INSTRUCTIONS.md)
- Scans for: escaped tildes (\~), gerunds, repeated phrases, keyword duplication
- Verb diversity requirements defined in core/verb-categories.md (5 categories, 20% target each)

**Gap Identified:**
- NO instruction that says: "IF issues found, REGENERATE bullets and re-validate"
- NO instruction to check verb diversity (all 5 categories represented)
- NO enforcement loop that repeats until all checks pass

**Impact:**
Quality issues can appear in final output:
- Escaped characters (\~, \%, \+) make it to final bullets
- Gerunds (-ing verbs) start bullets instead of past-tense verbs
- Exact phrases repeat 3+ times across positions
- Verb diversity fails (0% representation of a category)
- Same verb category repeats within a single position

**Root Cause:**
The system can DETECT problems but has no instruction to FIX them automatically.

### Fix #2: Missing Automatic Plain Text Export

**Current State:**
- No plain text export functionality exists in the system
- Users must manually copy bullets from markdown output
- No standardized format for plain text export

**Gap Identified:**
- NO instruction to auto-generate plain text file after quality gate passes
- NO defined output format for plain text export
- NO defined output location for generated files

**Impact:**
- Users waste time manually copy-pasting bullets
- Inconsistent formatting when users create their own exports
- No metadata (character count, word count) in plain text format
- No easy way to share bullets without markdown formatting

**Root Cause:**
Plain text export was never implemented as an automatic feature.

---

## Proposed Solution

### Solution #1: Implement Automatic Quality Gate

Add a new `<automatic_quality_gate>` section to PROJECT-INSTRUCTIONS.md that:

1. **Runs BEFORE presenting output** (blocking gate)
2. **Executes quality checklist** (existing automated_scan_patterns)
3. **Checks verb diversity:**
   - All 5 categories (Built, Lead, Managed, Improved, Collaborate) represented
   - No category appears 0 times
   - No category repeats within same position
4. **Regenerates if issues found:**
   - Identifies affected positions
   - Regenerates bullets using missing categories
   - Re-runs quality checklist
   - Repeats until all checks pass
5. **Proceeds to plain text export** (only after passing)

**Location:** PROJECT-INSTRUCTIONS.md, after line 646 (after `pre_output_quality_checklist`)

**Structure:**
```xml
<automatic_quality_gate>
  <trigger>After generating bullets, BEFORE presenting output:</trigger>
  <step_1_run_quality_checklist>
    Run pre_output_quality_checklist automated scans
  </step_1_run_quality_checklist>
  <step_2_check_verb_diversity>
    Verify: All 5 verb categories (Built, Lead, Managed, Improved, Collaborate)
    are represented across bullets
    Flag: Any category appearing 0 times = REGENERATE
    Flag: Same category repeated within position = REGENERATE
  </step_2_check_verb_diversity>
  <step_3_regenerate_if_needed>
    IF issues found:
      1. Identify affected positions
      2. Regenerate bullets using missing categories
      3. Re-run quality checklist
      4. Repeat until all checks pass
    ELSE: Proceed to step 4
  </step_3_regenerate_if_needed>
  <step_4_export_plain_text>
    Auto-generate plain text export (see automatic_plain_text_export)
  </step_4_export_plain_text>
</automatic_quality_gate>
```

### Solution #2: Implement Automatic Plain Text Export

Add a new `<automatic_plain_text_export>` section to PROJECT-INSTRUCTIONS.md that:

1. **Triggers after quality gate passes** (all bullets finalized)
2. **Formats output as plain text:**
   - Professional Summary
   - Position bullets (no markdown)
   - Character count per bullet
   - Total word count
3. **Creates file in standardized location:** `/mnt/user-data/outputs/[job-specific-name].txt`
4. **Presents output** using present_files tool

**Location:** PROJECT-INSTRUCTIONS.md, after `automatic_quality_gate`

**Structure:**
```xml
<automatic_plain_text_export>
  <trigger>After quality_gate passes and all bullets finalized</trigger>
  <format>
    [Professional Summary]

    POSITION 1: [Title] at [Company]
    • [Bullet 1]
    • [Bullet 2]
    • [Bullet 3]

    POSITION 2: [Title] at [Company]
    • [Bullet 1]
    • [Bullet 2]
    ...

    Character Count: X (target: 100-210 per bullet)
    Word Count: X (target: 350-500 total)
  </format>
  <output_location>Create as /mnt/user-data/outputs/[job-title]-bullets.txt</output_location>
  <presentation>Display in response with present_files tool</presentation>
  <no_markdown_instruction>
    Do NOT show markdown formatting in plain text file.
    Use plain text bullet points (•) only.
    No code blocks, no bold, no italics.
  </no_markdown_instruction>
</automatic_plain_text_export>
```

---

## Implementation Steps

### Phase 1: Update PROJECT-INSTRUCTIONS.md

1. Add `<automatic_quality_gate>` section after line 646
2. Add `<automatic_plain_text_export>` section after `<automatic_quality_gate>`
3. Update version number to 6.1.10
4. Add changelog entry

### Phase 2: Update core/format-rules.md

1. Add reference to automatic_quality_gate in quality_assurance_rules section
2. Add validation requirement for auto-export

### Phase 3: Testing

1. Test with sample JD + job history
2. Verify quality gate catches issues:
   - Escaped tildes
   - Gerunds
   - Missing verb categories
   - Repeated verb categories within position
3. Verify regeneration loop works
4. Verify plain text export creates file
5. Verify plain text format is correct

### Phase 4: Documentation

1. Update CHANGELOG.md with v6.1.10 entry
2. Update ROADMAP.md with completion status
3. Update any lessons-learned documents if needed

---

## Files to Modify

1. **PROJECT-INSTRUCTIONS.md** (primary changes)
   - Add `<automatic_quality_gate>` section
   - Add `<automatic_plain_text_export>` section
   - Update version to 6.1.10

2. **core/format-rules.md** (reference update)
   - Add validation requirements for quality gate
   - Add validation requirements for auto-export

3. **docs/CHANGELOG.md** (documentation)
   - Add v6.1.10 entry

4. **ROADMAP.md** (documentation)
   - Mark v6.1.10 as completed

---

## Expected Outcomes

### After Fix #1 (Automatic Quality Gate):
- Zero escaped characters in final output
- Zero gerunds starting bullets
- Zero missing verb categories (all 5 represented)
- Zero repeated verb categories within same position
- Zero repeated exact phrases (>2 occurrences)

### After Fix #2 (Automatic Plain Text Export):
- Plain text file auto-generated for every bullet generation
- Standardized format across all exports
- Character/word counts included
- No markdown formatting in plain text
- Easy copy-paste into resume

---

## Risk Assessment

**Low Risk:**
- These are additive changes (no breaking changes)
- Existing quality_assurance_rules remain unchanged
- New sections are independent and don't affect other phases

**Mitigation:**
- Test with multiple JD scenarios
- Verify regeneration loop doesn't get stuck (add max iteration limit if needed)
- Ensure plain text export doesn't fail if output directory doesn't exist

---

## Success Criteria

1. ✅ Quality gate runs automatically before output presentation
2. ✅ Quality gate catches and regenerates bullets with issues
3. ✅ All 5 verb categories represented in every resume output
4. ✅ Plain text file auto-generated after quality gate passes
5. ✅ Plain text format is clean (no markdown, proper bullet points)
6. ✅ Character/word counts included in plain text export
7. ✅ All tests pass

---

## Rollback Plan

If issues arise:
1. Revert commits on v6.1.10-fix_2nd_pass branch
2. Return to main branch
3. Document issues in lessons-learned
4. Re-plan with adjustments

---

## Notes

- This patch addresses gaps identified in user feedback about quality consistency
- The automatic quality gate transforms detection into enforcement
- Plain text export reduces manual work and improves user experience
- Both fixes work together: quality gate ensures clean output, export makes it easy to use

---

**Plan Status:** ✅ Ready for Implementation
**Approval Required:** Yes
**Estimated Implementation Time:** 30-45 minutes
